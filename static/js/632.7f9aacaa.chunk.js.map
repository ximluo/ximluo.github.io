{"version":3,"file":"static/js/632.7f9aacaa.chunk.js","mappings":"gPAqFO,MAAMA,EAUXC,WAAAA,CACEC,EACAC,EACAC,EACAC,GACC,KAdHH,cAAQ,OACRG,YAAM,OACNC,gBAAU,OACVC,UAAI,OACJC,aAAO,OACPC,YAAM,OACNC,iBAAW,OACXC,eAAS,EAQPC,KAAKV,SAAWA,EAChBU,KAAKP,OAASA,EACdO,KAAKN,WAAa,IAAIO,EAAAA,IAEtB,MAAMC,EAAM,IAAID,EAAAA,IAAwBV,EAAOC,EAAQ,CACrDW,MAAOF,EAAAA,IACPG,MAAOH,EAAAA,IACPI,UAAWJ,EAAAA,IACXK,UAAWL,EAAAA,IACXM,OAAQN,EAAAA,IACRO,KAAMP,EAAAA,IACNQ,eAAe,EACfC,aAAa,IAGfR,EAAIS,QAAQC,iBAAkB,EAE9BZ,KAAKL,KAAO,CAACO,EAAKA,EAAIW,SACtBb,KAAKJ,QAAU,EACfI,KAAKH,OAASG,KAAKL,KAAK,GACxBK,KAAKF,YAAc,IAAIG,EAAAA,IACrBV,GAAS,EACTA,EAAQ,EACRC,EAAS,EACTA,GAAU,EACV,KACA,KAEFQ,KAAKD,UAAY,IAAIE,EAAAA,IAAW,IAAIA,EAAAA,IAAoBV,EAAOC,GAASQ,KAAKP,QAC7EO,KAAKN,WAAWoB,IAAId,KAAKD,UAC3B,CAEAgB,MAAAA,GACEf,KAAKP,OAAOuB,SAASC,aAAaC,MAAQlB,KAAKL,KAAKK,KAAKJ,SAASe,QAClEX,KAAKJ,QAAU,EAAII,KAAKJ,QACxBI,KAAKH,OAASG,KAAKL,KAAKK,KAAKJ,SAC7BI,KAAKV,SAAS6B,gBAAgBnB,KAAKH,QACnCG,KAAKV,SAASyB,OAAOf,KAAKN,WAAYM,KAAKF,aAC3CE,KAAKV,SAAS6B,gBAAgB,KAChC,CAEAC,OAAAA,GACEpB,KAAKD,UAAUsB,SAASD,UACxBpB,KAAKL,KAAK2B,SAASpB,GAAQA,EAAIkB,WACjC,ECvIK,MCJDG,EAAoBC,IACxB,IAAIC,EAAID,GAAe,EAAVE,KAAKC,IAGlB,OAFIF,GAAKC,KAAKC,GAAIF,GAAe,EAAVC,KAAKC,GACnBF,EAAIC,KAAKC,KAAIF,GAAe,EAAVC,KAAKC,IACzBF,CAAC,EAGJG,EAAYA,CAACJ,EAAWK,EAAcC,IAAiBJ,KAAKK,IAAID,EAAMJ,KAAKM,IAAIH,EAAML,I,wBCN3F,MA6LaS,EAA2BC,IAgBwB,IAhBvB,GACvCC,EAAE,SACFC,EAAQ,OACRC,EAAM,aACNC,EAAY,QACZC,EAAO,SACPC,EAAQ,gBACRC,EAAe,mBACfC,EAAkB,aAClBC,EAAY,eACZC,EAAc,aACdC,EAAY,cACZC,EAAa,WACbC,EAAU,YACVC,EAAW,WACXC,GACgCf,EAChC,MAAMgB,EAAuBd,EAAW,IAAM,IAC9C,IAAIe,EAA2C,KAC/CP,EAAehD,QAAU,KACzB+C,EAAa/C,QAAU,KAEvB,MAAMwD,EAAe,IAAInD,EAAAA,IAAyB,CAChDoD,MAAO,QACPC,UAAW,EACXC,MAAO,EACPC,SAAU,GACVC,QAAS,KAGLC,GAAe,IAAIzD,EAAAA,KAAuB0D,cAAc,CAC5D,IAAI1D,EAAAA,IAAc,EAAG,GAAK,GAC1B,IAAIA,EAAAA,IAAc,EAAG,GAAK,KAEtB2D,EAAOX,EAAW,IAAIhD,EAAAA,IAAWyD,EAAcN,IACrDb,EAAQ3C,QAAUgE,EAElB,MAAMC,EAAe,IAAI5D,EAAAA,IAAkB,GAAK,GAAK,GAAK,EAAG,EAAG,GAC1D6D,EAA2B,GAC3BC,EAA2B,GAEjC,IAAK,IAAIC,EAAI,EAAGA,EAAI,GAAIA,IAAK,CAC3B,MAAMC,EAAO,IAAIhE,EAAAA,IAAW4D,EAAcb,EAAYpD,SACtDqE,EAAKV,MAAMW,IAAI,EAAG,EAAG,GACrBJ,EAAWK,KAAKlB,EAAWgB,GAC7B,CAEA,IAAK,IAAID,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAMC,EAAO,IAAIhE,EAAAA,IAAW4D,EAAcd,EAAWnD,SACrDqE,EAAKV,MAAMW,IAAI,EAAG,EAAG,GACrBH,EAAWI,KAAKlB,EAAWgB,GAC7B,CAEApB,EAAajD,QAAUkE,EACvBhB,EAAclD,QAAUmE,EAExBd,EAAW,IAAIhD,EAAAA,IAAmB,WAElC,MAAMmE,EAAmB,IAAInE,EAAAA,IAAuB,SAAU,GAC9DmE,EAAiBC,SAASH,IAAI,EAAG,EAAG,GACpCE,EAAiBE,YAAclC,EAC/BgC,EAAiBG,OAAOC,QAAQjF,MAAQ,IACxC6E,EAAiBG,OAAOC,QAAQhF,OAAS,IACzC4E,EAAiBG,OAAOE,OAAOC,KAAO,GACtCN,EAAiBG,OAAOE,OAAOE,IAAM,GACrCP,EAAiBG,OAAOE,OAAOG,MAAQ,GACvCR,EAAiBG,OAAOE,OAAOI,MAAQ,GACvCT,EAAiBG,OAAOE,OAAOK,QAAU,GACzCV,EAAiBG,OAAOE,OAAOM,IAAM,GACrCX,EAAiBG,OAAOS,OAAS,EACjCZ,EAAiBG,OAAOU,YAAc,EACtChC,EAAWmB,GAEX,MAAMc,EAAQjC,EACZ,IAAIkC,EAAAA,EAAU,IAAIlF,EAAAA,IAAoBqC,EAAa1C,QAAS0C,EAAa1C,SAAU,CACjFyD,MAAO,IAAIpD,EAAAA,IAAYoC,EAAO6C,OAC9BE,aAAclC,EACdmC,cAAenC,KAOnB,GAJAgC,EAAMI,SAASC,GAAK7D,KAAKC,GAAK,EAC9BuD,EAAMM,eAAgB,EACtBhD,EAAS5C,QAAUsF,EAEfA,EAAMO,oBAAoBxF,EAAAA,KAAwBiF,EAAMO,SAASzE,SAAS0E,WAAY,CACxF,MAAMC,EAAiBvD,EAAW,IAAM,IACxCe,EH7PF,IAAIlD,EAAAA,IAAqB,CACvBe,SAAU,CACRC,aAAc,CAAEC,MAAO,MACvB0E,KAAM,CAAE1E,MAAO,GACf2E,aAAc,CAAE3E,MAAO,IAAIjB,EAAAA,IAAc,GAAK,KAC9C6F,aAAc,CAAE5E,MAAO,IAAIjB,EAAAA,IAAc,GAAK,KAC9C8F,SAAU,CAAE7E,MAAO,IAErB8E,aAAc,mRAUdC,eAAgB,u9CG4OhBrD,EAAehD,QAAUuD,EACzBR,EAAa/C,QAAU,IAAIR,EAAU+C,EAAIwD,EAAgBA,EAAgBxC,EAC3E,CAEA,MAAM+C,EAAejD,EACnB,IAAIhD,EAAAA,IACF,IAAIA,EAAAA,IAAmB,IAAM,IAAM,IACnC,IAAIA,EAAAA,IAAwB,CAC1BoD,MAAO,IAAIpD,EAAAA,IAAYoC,EAAO8D,YAC9BC,aAAa,EACbC,QAAS,IACTC,KAAMrG,EAAAA,QAIZiG,EAAaZ,SAASC,GAAK7D,KAAKC,GAAK,EACrCuE,EAAa7B,SAASkC,EApSO,IAqS7BL,EAAaM,SAAU,EACvB/D,EAAgB7C,QAAUsG,EAE1B,MAAMO,EAAkBxD,EACtB,IAAIhD,EAAAA,IACF,IAAIA,EAAAA,IAAqB,IAAM,IAC/B,IAAIA,EAAAA,IAAwB,CAC1BoD,MAAO,IAAIpD,EAAAA,IAAYoC,EAAOqE,YAC9BJ,KAAMrG,EAAAA,QASZ,OALAwG,EAAgBnB,SAASC,GAAK7D,KAAKC,GAAK,EACxC8E,EAAgBpC,SAASkC,EAAII,KAC7BF,EAAgBD,SAAU,EAC1B9D,EAAmB9C,QAAU6G,EAEtB,CACLtD,cACAC,eACAM,eACAG,eACD,EC9QU+C,EAAqBC,IA0BH,IA1BI,MACjCC,EAAK,OACLrC,EAAM,GACNtC,EAAE,SACFC,EAAQ,OACRC,EAAM,eACN0E,EAAc,aACdzE,EAAY,UACZ0E,EAAS,cACTC,EAAa,WACbC,EAAU,YACVC,EAAW,UACXC,EAAS,gBACT3E,EAAe,mBACfC,EAAkB,SAClBF,EAAQ,QACRD,EAAO,aACPI,EAAY,eACZC,EAAc,aACdC,EAAY,cACZC,EAAa,WACbC,EAAU,UACVsE,EAAS,YACTrE,EAAW,WACXsE,EAAU,cACVC,GACuBV,GACvBW,EAAAA,EAAAA,YAAU,KACRV,EAAMW,IAAM,IAAIxH,EAAAA,IAAU,IAAIA,EAAAA,IAAYoC,EAAOoF,KAAKC,SAAU,GAAI,IACpEjD,EAAOJ,SAASH,IAAI,EAAG,EAAG,GAC1BO,EAAOkD,OAAO,EAAG,EAAG,GAEpB,MAAMC,EAAmC,GACnCC,EAAc,CAAEjI,SAAS,GAEzBqD,EAA0B6E,IAC9BhB,EAAMhG,IAAIgH,GACVF,EAAezD,KAAK2D,GACbA,IAGH,YAAE3E,EAAW,aAAEC,EAAY,aAAEM,EAAY,aAAEG,GAAiB5B,EAAyB,CACzFE,KACAC,WACAC,SACAC,eACAC,UACAC,WACAC,kBACAC,qBACAC,eACAC,iBACAC,eACAC,gBACAC,aACAC,cACAC,eAmBF,MDRoC8E,KAUA,IAVC,WACvC9E,EAAU,YACV4E,EAAW,eACXd,EAAc,UACdC,EAAS,cACTC,EAAa,WACbC,EAAU,YACVC,EAAW,UACXC,KACGY,GAC6BD,GACjB,IAAIE,EAAAA,GAEZC,KAAK,sBAAuBC,IACjC,GAAIN,EAAYjI,QAAS,OAEzB,MAAMwI,EAAQD,EAAKrB,MACbuB,EAASD,EAAME,gBAAgB,UAC/BC,EAAaH,EAAME,gBAAgB,QACnCE,EAAWJ,EAAME,gBAAgB,YACjCG,EAAUL,EAAME,gBAAgB,WAChCI,EAAON,EAAME,gBAAgB,QAC7BK,EAAWP,EAAME,gBAAgB,YACjCM,EAAYR,EAAME,gBAAgB,aAClCO,EAAUT,EAAME,gBAAgB,WAChCQ,EAAWV,EAAME,gBAAgB,YACjCS,EAASX,EAAME,gBAAgB,UAC/B5B,EAAa0B,EAAME,gBAAgB,cACnCU,EAAcZ,EAAME,gBAAgB,eAGvCD,GACAE,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACArC,GACAsC,IA3FiCC,EACtCC,EAAuBrC,KAEnB,IADJ,WAAE9D,EAAU,UAAEsE,EAAS,YAAErE,EAAW,WAAEsE,EAAU,cAAEC,GAAkCV,EAEpFqC,EAAMH,OAAOzD,SAAS6D,EAAI,GAC1BD,EAAMH,OAAOzD,SAASC,EAAI,GAE1B2D,EAAMX,WAAW9C,SAAW1C,EAAWnD,QACvCsJ,EAAMV,SAAS/C,SAAW1C,EAAWnD,QACrCsJ,EAAMT,QAAQhD,SAAW1C,EAAWnD,QACpCsJ,EAAMR,KAAKjD,SAAW1C,EAAWnD,QACjCsJ,EAAMP,SAASlD,SAAW4B,EAAUzH,QACpCsJ,EAAMN,UAAUnD,SAAW4B,EAAUzH,QACrCsJ,EAAML,QAAQpD,SAAW4B,EAAUzH,QACnCsJ,EAAMJ,SAASrD,SAAW4B,EAAUzH,QACpCsJ,EAAMH,OAAOtD,SAAWzC,EAAYpD,QACpCsJ,EAAMxC,WAAWjB,SAAW6B,EAAW1H,QACvCsJ,EAAMF,YAAYvD,SAAW6B,EAAW1H,QAExC,MAAMwJ,EAAcC,IAClB,MAAMC,EAAUD,EAAIxI,QACpByI,EAAQC,SAAW,GACnBD,EAAQjF,SAASH,IAAI,EAAG,EAAG,GAC3BoF,EAAQhE,SAASpB,IAAI,EAAG,EAAG,GAC3BoF,EAAQ/F,MAAMW,IAAI,EAAG,EAAG,GACxBoF,EAAQ7D,SAAW8B,EAAc3H,QACjCyJ,EAAIvI,IAAIwI,EAAQ,EAGlBF,EAAWF,EAAMX,YACjBa,EAAWF,EAAMV,UACjBY,EAAWF,EAAMT,SACjBW,EAAWF,EAAMR,MACjBU,EAAWF,EAAMH,QAEjBG,EAAMb,OAAOmB,UAAU1B,IAChBA,EAAsB2B,SACzB3B,EAAOxD,YAAa,EACpBwD,EAAOtC,eAAgB,EACzB,IAGF0D,EAAMH,OAAOS,UAAU1B,IAChBA,EAAsB2B,SACzB3B,EAAOxD,YAAa,EACtB,GACA,EAiEA2E,CAfgC,CAC9BZ,SACAE,aACAC,WACAC,UACAC,OACAC,WACAC,YACAC,UACAC,WACAC,SACArC,aACAsC,eAGqChB,GAEvC/E,EAAWoF,GACXpF,EAAW8F,GAEX/B,EAAUpH,QAAUyI,EACpBpB,EAAcrH,QAAU2I,EACxBrB,EAAWtH,QAAU6I,EACrBtB,EAAYvH,QAAU4I,EACtBpB,EAAUxH,QAAUmJ,EAEpBhC,GAAe,GAAK,GACpB,EClFA2C,CAAyB,CACvBzG,aACA4E,cACAd,iBACAC,YACAC,gBACAC,aACAC,cACAC,YACArE,aACAsE,YACArE,cACAsE,aACAC,kBAGK,KAAO,IAADoC,EAAAC,EAAAC,EACXhC,EAAYjI,SAAU,EACtBmH,GAAe,GAEG,QAAjB4C,EAACnH,EAAS5C,eAAO,IAAA+J,GAA2D,QAA3DC,EAAjBD,EAAqEvI,eAAO,IAAAwI,GAA5EA,EAAAE,KAAAH,GAED/B,EAAetG,SAASwG,IAClBA,EAAOiC,SAAWjD,GACpBA,EAAMkD,OAAOlC,EACf,IA5HyBmC,KAC/B,MAAMC,EAAa,IAAIC,IAEvBF,EAAQ3I,SAASwG,IACfA,EAAO0B,UAAUY,IACf,GAAKA,EAAqBX,QAAWW,EAAqBC,OAAQ,CAChE,MAAMhJ,EAAY+I,EAAkC/I,SAChDA,GACF6I,EAAWpJ,IAAIO,EAEnB,IACA,IAGJ6I,EAAW5I,SAASD,GAAaA,EAASD,WAAU,EAiHhDkJ,CAAwB1C,GACxBlE,EAAatC,UACbgC,EAAahC,UACbyC,EAAazC,UACF,OAAX+B,QAAW,IAAXA,GAAAA,EAAa/B,UACO,QAApByI,EAAAlH,EAAa/C,eAAO,IAAAiK,GAApBA,EAAsBzI,UAEtBmB,EAAQ3C,QAAU,KAClB4C,EAAS5C,QAAU,KACnB6C,EAAgB7C,QAAU,KAC1B8C,EAAmB9C,QAAU,KAC7BoH,EAAUpH,QAAU,KACpBqH,EAAcrH,QAAU,KACxBsH,EAAWtH,QAAU,KACrBuH,EAAYvH,QAAU,KACtBwH,EAAUxH,QAAU,KACpBiD,EAAajD,QAAU,GACvBkD,EAAclD,QAAU,GACxBgD,EAAehD,QAAU,KACzB+C,EAAa/C,QAAU,IAAI,CAC5B,GACA,CACDoD,EACAL,EACA8B,EACA/B,EACAD,EACA2E,EACA/E,EACA6E,EACAC,EACA3E,EACAI,EACAN,EACAH,EACAC,EACAkF,EACA/E,EACAgF,EACAzE,EACAD,EACAE,EACAkE,EACAD,EACAF,EACAO,EACAN,GACA,EC+LJ,EAxW8CF,IAA8C,IAA7C,OAAExE,EAAM,kBAAEkI,EAAiB,SAAEnI,GAAUyE,EACpF,MAAM,MAAEC,EAAK,GAAE3E,EAAE,OAAEsC,IAAW+F,EAAAA,EAAAA,MACvBC,EAAa1D,IAAkB2D,EAAAA,EAAAA,WAAS,IACxCC,EAAWC,IAAgBF,EAAAA,EAAAA,WAAS,GAErC1D,GAAY6D,EAAAA,EAAAA,QAA2B,MACvC5D,GAAgB4D,EAAAA,EAAAA,QAA8B,MAC9C3D,GAAa2D,EAAAA,EAAAA,QAA8B,MAC3C1D,GAAc0D,EAAAA,EAAAA,QAA8B,MAC5CzD,GAAYyD,EAAAA,EAAAA,QAA8B,MAC1CpI,GAAkBoI,EAAAA,EAAAA,QAA0B,MAC5CnI,GAAqBmI,EAAAA,EAAAA,QAA0B,MAC/CrI,GAAWqI,EAAAA,EAAAA,QAAyB,MACpCtI,GAAUsI,EAAAA,EAAAA,QAA0B,MACpClI,GAAekI,EAAAA,EAAAA,QAAyB,MACxCjI,GAAiBiI,EAAAA,EAAAA,QAAoC,MACrDhI,GAAegI,EAAAA,EAAAA,QAAqB,IACpC/H,GAAgB+H,EAAAA,EAAAA,QAAqB,IAErCC,GAAeD,EAAAA,EAAAA,QAAO,IAAI5K,EAAAA,IAAc,EAAG,IAC3C8K,GAAgBF,EAAAA,EAAAA,QAAO,GACvBG,GAAsBH,EAAAA,EAAAA,QAAO,GAC7BI,GAAkBJ,EAAAA,EAAAA,QAAO,IAAI5K,EAAAA,IAAc,GAAK,KAChDiL,GAAkBL,EAAAA,EAAAA,QAAO,IAAI5K,EAAAA,IAAc,GAAK,KAChDkL,GAAqBN,EAAAA,EAAAA,QAAO,IAAI5K,EAAAA,IAAc,GAAK,KACnDmL,GAAsBP,EAAAA,EAAAA,QAAO,IAAI5K,EAAAA,IAAc,EAAG,IAClDoL,GAAgBR,EAAAA,EAAAA,QAAO,CAAES,aAAc,IACvCC,GAAiBV,EAAAA,EAAAA,SAAO,GACxBW,GAAWX,EAAAA,EAAAA,QAAO,IAAI5K,EAAAA,KACtBwL,GAAeZ,EAAAA,EAAAA,QAAO,IAAI5K,EAAAA,KAC1BqC,GAAeuI,EAAAA,EAAAA,QAAO,IACtBa,GAAUb,EAAAA,EAAAA,QAAO,GAEjB9H,GAAa8H,EAAAA,EAAAA,QACjB,IAAI5K,EAAAA,GAAuB,CAAEoD,MAAO,IAAIpD,EAAAA,IAAYoC,EAAOsJ,iBAEvDtE,GAAYwD,EAAAA,EAAAA,QAChB,IAAI5K,EAAAA,GAAuB,CAAEoD,MAAO,IAAIpD,EAAAA,IAAYoC,EAAOuJ,mBAEvD5I,GAAc6H,EAAAA,EAAAA,QAClB,IAAI5K,EAAAA,GAAuB,CAAEoD,MAAO,IAAIpD,EAAAA,IAAYoC,EAAO8D,eAEvDmB,GAAauD,EAAAA,EAAAA,QACjB,IAAI5K,EAAAA,GAAuB,CAAEoD,MAAO,IAAIpD,EAAAA,IAAYoC,EAAOqE,eAEvDa,GAAgBsD,EAAAA,EAAAA,QL3DtB,IAAI5K,EAAAA,IAAqB,CACvBe,SAAU,CACRqC,MAAO,CAAEnC,MAAO,IAAIjB,EAAAA,IAAY,IAChC4L,KAAM,CAAE3K,MAAO,KACf0E,KAAM,CAAE1E,MAAO,IAEjB8E,aAAc,kVAUdC,eAAgB,4GAMhBK,KAAMrG,EAAAA,QKuCRuH,EAAAA,EAAAA,YAAU,KAQR,GAPAzE,EAAWnD,QAAQyD,MAAMa,IAAI7B,EAAOsJ,cACpCtE,EAAUzH,QAAQyD,MAAMa,IAAI7B,EAAOuJ,gBACnC5I,EAAYpD,QAAQyD,MAAMa,IAAI7B,EAAO8D,YACrCmB,EAAW1H,QAAQyD,MAAMa,IAAI7B,EAAOqE,YACpCa,EAAc3H,QAAQoB,SAASqC,MAAMnC,MAAQ,IAAIjB,EAAAA,IAAYoC,EAAOiH,SACpExC,EAAMW,IAAM,IAAIxH,EAAAA,IAAU,IAAIA,EAAAA,IAAYoC,EAAOoF,KAAKC,SAAU,GAAI,IAEhElF,EAAS5C,QAAS,CAAC,IAADkM,EACpB,MAAMC,EAAMvJ,EAAS5C,QAAQ6F,SAIzBsG,EAAI1I,MACN0I,EAAI1I,MAAMa,IAAI7B,EAAO6C,OACA,QAAhB4G,EAAIC,EAAI/K,gBAAQ,IAAA8K,GAAZA,EAAczI,OACvB0I,EAAI/K,SAASqC,MAAMnC,MAAMgD,IAAI,IAAIjE,EAAAA,IAAYoC,EAAO6C,OAExD,CAEA,GAAIzC,EAAgB7C,QAAS,CACT6C,EAAgB7C,QAAQ6F,SAChCpC,MAAMa,IAAI7B,EAAO8D,WAC7B,CAEA,GAAIzD,EAAmB9C,QAAS,CACT8C,EAAmB9C,QAAQ6F,SACnCpC,MAAMa,IAAI7B,EAAOqE,WAChC,IACC,CAACrE,EAAQyE,IAEZF,EAAmB,CACjBE,QACArC,SACAtC,KACAC,WACAC,SACA0E,iBACAzE,eACA0E,YACAC,gBACAC,aACAC,cACAC,YACA3E,kBACAC,qBACAF,WACAD,UACAI,eACAC,iBACAC,eACAC,gBACAC,aACAsE,YACArE,cACAsE,aACAC,mBAGFC,EAAAA,EAAAA,YAAU,KACR,MAAMwE,EAAaX,EAAczL,QAC3BqM,EAAUlJ,EAAWnD,QACrBsM,EAAS7E,EAAUzH,QACnBuM,EAAWnJ,EAAYpD,QACvBwM,EAAU9E,EAAW1H,QACrByM,EAAa9E,EAAc3H,QAEjC,MAAO,KACL0M,EAAAA,GAAKC,aAAaP,GAClBC,EAAQ7K,UACR8K,EAAO9K,UACP+K,EAAS/K,UACTgL,EAAQhL,UACRiL,EAAWjL,SAAS,CACrB,GACA,IAEH,MAAMoL,GAAmBC,EAAAA,EAAAA,cAAY,KAC/BhK,EAAgB7C,UAAS6C,EAAgB7C,QAAQ4G,SAAU,GAC3D9D,EAAmB9C,UAAS8C,EAAmB9C,QAAQ4G,SAAU,EAAK,GACzE,IAEGkG,GAAcD,EAAAA,EAAAA,cAAY,KAC9B,IAAKrF,EAAUxH,QAAS,OAExB4M,IAEA,MAAMG,EAAavK,EAAW,IAAO,GAC/BwK,GAAMlL,KAAKmL,SAAW,IAAOF,EAC7BG,GAAMpL,KAAKmL,SAAW,IAAOF,EAC7BI,EAAI,GAAsB,EAAhBrL,KAAKmL,SACfG,EAASJ,EAAKtK,EAAa1C,QAC3BqN,EAASH,EAAKxK,EAAa1C,QAEjCwH,EAAUxH,QAAQyE,SAASkB,EAAIyH,EAC/B5F,EAAUxH,QAAQyE,SAAS8E,EAAI8D,EAC/B7F,EAAUxH,QAAQyE,SAASkC,GAAK,EAEhCa,EAAUxH,QAAQ2D,MAAMW,IAAI,EAAG,EAAG,GAClCkD,EAAUxH,QAAQ4G,SAAU,EAExBuG,EAvJ6B,KAuJOtK,EAAgB7C,SAAW8C,EAAmB9C,UACpF6C,EAAgB7C,QAAQ4G,SAAU,EAClC9D,EAAmB9C,QAAQ4G,SAAU,EACrC/D,EAAgB7C,QAAQyE,SAASH,IAAI8I,EAzJZ,IAyJ4CC,GACrEvK,EAAmB9C,QAAQyE,SAASH,IAAI8I,EAAQrG,KAAgCsG,GAChFxK,EAAgB7C,QAAQ2D,MAAMW,IAAI,GAAK,GAAK,IAC5CxB,EAAmB9C,QAAQ2D,MAAMW,IAAI,EAAG,EAAG,GAE3CoI,EAAAA,GAAKY,GAAGzK,EAAgB7C,QAAQ2D,MAAO,CACrC4J,SAAU,GACVC,KAAM,cACN7H,EAAG,EACHgB,EAAG,EACH4C,EAAG,IAGLmD,EAAAA,GAAKY,GAAGxK,EAAmB9C,QAAQ2D,MAAO,CACxC4J,SAAU,GACVC,KAAM,gBACN7H,EAAG,EACHgB,EAAG,EACH4C,EAAG,KAIPmD,EAAAA,GAAKY,GAAG9F,EAAUxH,QAAQ2D,MAAO,CAC/B4J,SAAU,IACVC,KAAM,cACN7H,EAAG,EACHgB,EAAG,EACH4C,EAAG,IAGLmD,EAAAA,GAAKY,GAAG9F,EAAUxH,QAAQyE,SAAU,CAClC8I,SAAU,IACVC,KAAM,cACN7G,EAAGwG,GACH,GACD,CAACP,EAAkBpK,IAEhBiL,GAAUZ,EAAAA,EAAAA,cACba,IACC/B,EAAe3L,SAAU,EAEzB,IAAK,MAAMqE,KAAQpB,EAAajD,QAC9BqE,EAAKI,SAASH,IAAIoJ,EAAI/H,EAAG+H,EAAI/G,EAAG+G,EAAInE,GACpClF,EAAKV,MAAMW,IAAI,EAAG,EAAG,GAErBoI,EAAAA,GAAKY,GAAGjJ,EAAKI,SAAU,CACrBkB,EAAG+H,EAAI/H,EAA6B,MAAvB,GAAM7D,KAAKmL,UACxBtG,EAAG+G,EAAI/G,EAA4B,KAAvB,GAAM7E,KAAKmL,UACvB1D,EAAGmE,EAAInE,EAA6B,MAAvB,GAAMzH,KAAKmL,UACxBM,SAAU,EACVC,KAAM,eAGRd,EAAAA,GAAKY,GAAGjJ,EAAKV,MAAO,CAClBgC,EAAG,EACHgB,EAAG,EACH4C,EAAG,EACHgE,SAAU,EACVC,KAAM,aACNG,WAAYA,KACVb,IACAnB,EAAe3L,SAAU,CAAK,IAKpC,IAAK,MAAMqE,KAAQnB,EAAclD,QAC/BqE,EAAKI,SAASH,IAAIoJ,EAAI/H,EAAG+H,EAAI/G,EAAG+G,EAAInE,GACpClF,EAAKV,MAAMW,IAAI,EAAG,EAAG,GAErBoI,EAAAA,GAAKY,GAAGjJ,EAAKI,SAAU,CACrBkB,EAAG+H,EAAI/H,EAA6B,MAAvB,GAAM7D,KAAKmL,UACxBtG,EAAG+G,EAAI/G,EAA4B,KAAvB,GAAM7E,KAAKmL,UACvB1D,EAAGmE,EAAInE,EAA6B,MAAvB,GAAMzH,KAAKmL,UACxBM,SAAU,EACVC,KAAM,eAGRd,EAAAA,GAAKY,GAAGjJ,EAAKV,MAAO,CAClBgC,EAAG,EACHgB,EAAG,EACH4C,EAAG,EACHgE,SAAU,EACVC,KAAM,cAEV,GAEF,CAACV,IAGGc,GAAgBf,EAAAA,EAAAA,cAAY,KAChC,GAAIlB,EAAe3L,UAAYoH,EAAUpH,UAAYwH,EAAUxH,QAAS,OAExE,MAAM6N,EAAUzG,EAAUpH,QAAQyE,SAASxD,QAC3C4M,EAAQC,IAAItG,EAAUxH,QAAQyE,UAE1BoJ,EAAQE,UAAY,GAAKvG,EAAUxH,QAAQ4G,UAC7CY,EAAUxH,QAAQ4G,SAAU,EAC5BgG,IACAa,EAAQjG,EAAUxH,QAAQyE,SAASxD,SACnC0J,IACF,GACC,CAAC8C,EAASb,EAAkBjC,IAEzBqD,GAAOnB,EAAAA,EAAAA,cAAY,KACvB,IACGzF,EAAUpH,UACVqH,EAAcrH,UACdsH,EAAWtH,UACXuH,EAAYvH,QAEb,OAGFgL,GAAa,GACb,MAAMiD,EAAQnM,KAAKwD,MAAsC,EAAhC4F,EAAalL,QAAQ+N,UAAgB,EACxDG,EAAe,GAAc,GAARD,EACrBE,EAAY/C,EAAoBpL,QAAU,EAAc,EAAV8B,KAAKC,GAASkM,EAAmB,GAAVnM,KAAKC,GAASkM,EAEzFvB,EAAAA,GAAKY,GAAGjG,EAAcrH,QAAQ0F,SAAU,CACtC6H,SAAUW,EACVV,KAAM,cACN7G,EAAGwH,EACHR,WAAYA,KACNtG,EAAcrH,UAASqH,EAAcrH,QAAQ0F,SAASiB,EAAI,EAAC,IAInE+F,EAAAA,GAAKY,GAAG,CAAChG,EAAWtH,QAAQ0F,SAAU6B,EAAYvH,QAAQ0F,UAAW,CACnE6H,SAAyB,GAAfW,EACVV,KAAM,aACN7H,EAAG7D,KAAKC,GAAK,IAGf2K,EAAAA,GAAKY,GAAG,CAAChG,EAAWtH,QAAQ0F,SAAU6B,EAAYvH,QAAQ0F,UAAW,CACnE6H,SAAyB,GAAfW,EACVE,MAAsB,GAAfF,EACPV,KAAM,YACN7H,EAAG,IAGL+G,EAAAA,GAAKY,GAAG7B,EAAczL,QAAS,CAC7BuN,SAAyB,GAAfW,EACVV,KAAM,aACN9B,aAAc,GACd2C,SAAUA,KACR,IAAKjH,EAAUpH,QAAS,OACxB,MAAMsO,EAAMxM,KAAKwM,IAAI7C,EAAczL,QAAQ0L,aAAe5J,KAAKC,IAC/DqF,EAAUpH,QAAQyE,SAASkC,EAAI7E,KAAKyM,IAAID,EAAK,GAAKL,CAAK,IAI3DvB,EAAAA,GAAKY,GAAG7B,EAAczL,QAAS,CAC7BuN,SAAyB,GAAfW,EACVV,KAAM,YACNY,MAAsB,GAAfF,EACPxC,aAAc,EACd2C,SAAUA,KACR,IAAKjH,EAAUpH,QAAS,OACxB,MAAMsO,EAAMxM,KAAKwM,IAAI7C,EAAczL,QAAQ0L,aAAe5J,KAAKC,IAC/DqF,EAAUpH,QAAQyE,SAASkC,EAAI7E,KAAKyM,IAAID,EAAK,GAAKL,CAAK,EAEzDN,WAAYA,KACLvG,EAAUpH,UACfoH,EAAUpH,QAAQyE,SAASkC,EAAI,EAC/B8E,EAAczL,QAAQ0L,aAAe,EACrCV,GAAa,GAAM,GAErB,GACD,IAqCH,MJ5WkC/D,KAKH,IALI,SACnC2E,EAAQ,UACRxE,EAAS,UACT2D,EAAS,OACTyD,GACyBvH,GACzBW,EAAAA,EAAAA,YAAU,KACR,MAAM6G,EAAmBC,IACvB9C,EAAS5L,QAAQ2F,EAAK+I,EAAMC,QAAUC,OAAOC,WAAc,EAAI,EAC/DjD,EAAS5L,QAAQ2G,GAAM+H,EAAMI,QAAUF,OAAOG,YAAe,EAAI,CAAC,EAG9DC,EAAmBN,IACM,IAAzBA,EAAMO,QAAQlB,SAClBW,EAAMQ,iBACNtD,EAAS5L,QAAQ2F,EAAK+I,EAAMO,QAAQ,GAAGN,QAAUC,OAAOC,WAAc,EAAI,EAC1EjD,EAAS5L,QAAQ2G,GAAM+H,EAAMO,QAAQ,GAAGH,QAAUF,OAAOG,YAAe,EAAI,EAAC,EAGzEI,EAAcA,KACd/H,EAAUpH,UAAY+K,GACxByD,GACF,EAQF,OALAI,OAAOQ,iBAAiB,YAAaX,GACrCG,OAAOQ,iBAAiB,YAAaJ,EAAiB,CAAEK,SAAS,IACjET,OAAOQ,iBAAiB,YAAaD,GACrCP,OAAOQ,iBAAiB,aAAcD,GAE/B,KACLP,OAAOU,oBAAoB,YAAab,GACxCG,OAAOU,oBAAoB,YAAaN,GACxCJ,OAAOU,oBAAoB,YAAaH,GACxCP,OAAOU,oBAAoB,aAAcH,EAAY,CACtD,GACA,CAACpE,EAAWa,EAAU4C,EAAQpH,GAAW,EIqS5CmI,CAAqB,CACnB3D,WACAxE,YACA2D,YACAyD,OAAQR,IH1SuB/G,KA0BH,IA1BI,YAClC4D,EAAW,SACXrI,EAAQ,UACRuI,EAAS,OACTlG,EAAM,QACNiH,EAAO,cACPnE,EAAa,UACbP,EAAS,WACTE,EAAU,YACVC,EAAW,UACXC,EAAS,SACT5E,EAAQ,QACRD,EAAO,eACPK,EAAc,aACdD,EAAY,aACZL,EAAY,SACZkJ,EAAQ,aACRC,EAAY,aACZX,EAAY,cACZC,EAAa,oBACbC,EAAmB,gBACnBC,EAAe,gBACfC,EAAe,mBACfC,EAAkB,oBAClBC,EAAmB,iBACnBgE,GACwBvI,GACxBwI,EAAAA,EAAAA,IAAS,CAACC,EAAGC,KACX,IAAK9E,EAAa,OAElB,MAAM+E,EAAK9N,KAAKK,IAAIwN,EAAO,IAI3B,GAHA7D,EAAQ9L,SAAW4P,EACnBjI,EAAc3H,QAAQoB,SAAS4E,KAAK1E,MAAQwK,EAAQ9L,SAGjDoH,EAAUpH,UACV2C,EAAQ3C,UACR4C,EAAS5C,QAEV,OAGF6L,EAAa7L,QAAQ6P,cAAcjE,EAAS5L,QAAS6E,GACrD,MAAMiL,EAAajE,EAAa7L,QAAQ+P,gBAAgBnN,EAAS5C,SAE7D8P,EAAW/B,OAAS,GAAK+B,EAAW,GAAGE,KACzCzE,EAAmBvL,QAAQ2F,EAAImK,EAAW,GAAGE,GAAGrK,EAChD4F,EAAmBvL,QAAQ2G,EAAImJ,EAAW,GAAGE,GAAGrJ,GAGlD,MAAMsJ,EAAazN,EAAW,IAAO,GAC/B0N,EAAkBlO,EAAUuJ,EAAmBvL,QAAQ2F,EAAI,IAAMsK,EAAYA,GAC7EE,EAAkBnO,EAAUuJ,EAAmBvL,QAAQ2G,EAAI,IAAMsJ,EAAYA,GACnFzE,EAAoBxL,QAAQ2F,EAAIuK,EAAkBxN,EAAa1C,QAC/DwL,EAAoBxL,QAAQ2G,GAAKwJ,EAAkBzN,EAAa1C,QAEhE,MAAMoQ,EAAK5E,EAAoBxL,QAAQ2F,EAAIyB,EAAUpH,QAAQyE,SAASkB,EAChE0K,EAAK7E,EAAoBxL,QAAQ2G,EAAIS,EAAUpH,QAAQyE,SAAS8E,EAEhE+G,EAAQxO,KAAKyO,MAAMF,EAAID,GACvBI,EAAe1O,KAAK2O,KAAKL,EAAKA,EAAKC,EAAKA,GACxCK,EAAKN,EAAKR,EAAK,GACfe,EAAKN,EAAKT,EAAK,GAErB1E,EAAalL,QAAQ2F,GAAK+K,EAC1BxF,EAAalL,QAAQ2G,GAAKgK,EAC1BzF,EAAalL,QAAQ2F,GAAK7D,KAAKyM,IAAIqB,EAAI,MACvC1E,EAAalL,QAAQ2G,GAAK7E,KAAKyM,IAAIqB,EAAI,MAEvCxI,EAAUpH,QAAQyE,SAASkB,GAAKuF,EAAalL,QAAQ2F,EACrDyB,EAAUpH,QAAQyE,SAAS8E,GAAK2B,EAAalL,QAAQ2G,EAErD,MAAMwH,GAAamC,EAAQxO,KAAKC,GAAK,EACjCyO,EAAe,KACjBpJ,EAAUpH,QAAQ0F,SAASiB,GACoC,EAA7DhF,EAAiBwM,EAAY/G,EAAUpH,QAAQ0F,SAASiB,GAASiJ,GAGrExE,EAAoBpL,QAAU2B,EAC5ByF,EAAUpH,QAAQ0F,SAASiB,EAAIwE,EAAcnL,SAE/CmL,EAAcnL,QAAUoH,EAAUpH,QAAQ0F,SAASiB,GAE9CoE,GAAazD,EAAWtH,SAAWuH,EAAYvH,UAClDsH,EAAWtH,QAAQ0F,SAASC,EAAI4B,EAAYvH,QAAQ0F,SAASC,EAC1B,GAAhCuF,EAAalL,QAAQ+N,UAG1B,MAAM6C,EAAiBjO,EAAQ3C,QAAQyB,SAAkCoP,WAAWpM,SACjFqM,MAYH,GAXAF,EAAc,GAAKpF,EAAoBxL,QAAQ2F,EAC/CiL,EAAc,GAAKpF,EAAoBxL,QAAQ2G,EAC/CiK,EAAc,GAAKxJ,EAAUpH,QAAQyE,SAASkB,EAC9CiL,EAAc,GAAKxJ,EAAUpH,QAAQyE,SAASkC,EAC9CiK,EAAc,GAAKxJ,EAAUpH,QAAQyE,SAAS8E,EAC5C5G,EAAQ3C,QAAQyB,SAAkCoP,WAAWpM,SAASsM,aAAc,EACtFpO,EAAQ3C,QAAQgR,uBAEhB1F,EAAgBtL,QAAQ2F,EAAI,GAAMyB,EAAUpH,QAAQyE,SAASkB,EAAIjD,EAAa1C,QAC9EsL,EAAgBtL,QAAQ2G,EAAI,GAAMS,EAAUpH,QAAQyE,SAAS8E,EAAI7G,EAAa1C,QAE1E4C,EAAS5C,QAAQ6F,oBAAoBxF,EAAAA,IAAsB,CAC7D,MACM4Q,EADWrO,EAAS5C,QAAQ6F,SAASzE,SACX0E,WAE5BmL,GAAkBjO,EAAehD,SAAW+C,EAAa/C,UAC3DgD,EAAehD,QAAQoB,SAAS4E,KAAK1E,OAASsO,EAC9C5M,EAAehD,QAAQoB,SAAS8E,aAAa5E,MAAQgK,EAAgBtL,QACrEgD,EAAehD,QAAQoB,SAAS6E,aAAa3E,MAAQ+J,EAAgBrL,QACrEgD,EAAehD,QAAQoB,SAAS+E,SAAS7E,MAAQyJ,EAC7C,EACA,GAAK,EAAoC,GAAhCG,EAAalL,QAAQ+N,UAElChL,EAAa/C,QAAQmB,SACrB8P,EAAe3P,MAAQyB,EAAa/C,QAAQC,OAAOc,QAEvD,CAEAsK,EAAgBrL,QAAQkR,KAAK5F,EAAgBtL,SAEzCwH,EAAUxH,UACZwH,EAAUxH,QAAQ0F,SAASiB,GAAKiJ,GAGlCJ,GAAkB,GAClB,EGgLF2B,CAAoB,CAClBtG,cACArI,WACAuI,YACAlG,SACAiH,UACAnE,gBACAP,YACAE,aACAC,cACAC,YACA5E,WACAD,UACAK,iBACAD,eACAL,eACAkJ,WACAC,eACAX,eACAC,gBACAC,sBACAC,kBACAC,kBACAC,qBACAC,sBACAgE,iBAAkB5B,IAGb,IAAI,ECpXPwD,EAA2B,qBAE3BC,EAA0B/P,IAC9B,GAAc,OAAVA,EAAgB,OAAO,EAC3B,MAAMgQ,EAASC,SAASjQ,EAAO,IAC/B,OAAIkQ,OAAOC,MAAMH,IAAWA,EAAS,EAAU,EACxCA,CAAM,EAiDf,EA9CyBI,KACvB,MAAOC,EAAaC,IAAkB9G,EAAAA,EAAAA,WAAS,IACvB,qBAAX8D,OAA+B,EACnCyC,EAAuBzC,OAAOiD,eAAeC,QAAQV,MAExDW,GAAmB9G,EAAAA,EAAAA,SAAO,IAEhCrD,EAAAA,EAAAA,YAAU,KACR,GAAsB,qBAAXgH,OAAwB,OAEnC,MAAMoD,EAAiBtD,IACrB,GAAIA,EAAMuD,MAAQb,EAA0B,OAC5C,MAAMc,EAAOb,EAAuB3C,EAAMyD,UAE1CP,GAAgBQ,GACVA,IAASF,EAAaE,GAC1BL,EAAiB/R,SAAU,EACpBkS,IACP,EAIJ,OADAtD,OAAOQ,iBAAiB,UAAW4C,GAC5B,IAAMpD,OAAOU,oBAAoB,UAAW0C,EAAc,GAChE,KAEHpK,EAAAA,EAAAA,YAAU,KACc,qBAAXgH,SAEPmD,EAAiB/R,QACnB+R,EAAiB/R,SAAU,EAI7B4O,OAAOiD,eAAeQ,QAAQjB,EAA0BO,EAAYW,YAAW,GAC9E,CAACX,IAEJ,MAAMY,GAAuB1F,EAAAA,EAAAA,cAAY,KACvC+E,GAAgBQ,GAASA,EAAO,GAAE,GACjC,IAEH,MAAO,CACLT,cACAY,uBACD,E,aCvCH,MAAMC,EAAgB,mBA2GtB,EAzG8CvL,IAAyB,IAAxB,QAAEwL,EAAO,MAAEC,GAAOzL,EAC/D,MAAM0L,GAAY1H,EAAAA,EAAAA,QAA8B,OACzC2H,EAASC,IAAc/H,EAAAA,EAAAA,WAAS,GACjCtI,GAAWsQ,EAAAA,EAAAA,GAAY,MACvB,YAAEnB,EAAW,qBAAEY,GAAyBb,KAE9C9J,EAAAA,EAAAA,YAAU,KACR,GAAwB,qBAAbmL,SAA0B,OAErC,IAAIC,EAAOD,SAASE,eAAeT,GAC9BQ,IACHA,EAAOD,SAASG,cAAc,OAC9BF,EAAKG,GAAKX,EACVO,SAASK,KAAKC,YAAYL,IAG5B,MAAMM,EAAYP,SAASG,cAAc,OAKzC,OAJAF,EAAKK,YAAYC,GACjBX,EAAU3S,QAAUsT,EACpBT,GAAW,GAEJ,KAAO,IAADU,EACPZ,EAAU3S,SAAe,QAARuT,EAAIP,SAAI,IAAAO,GAAJA,EAAMC,SAASb,EAAU3S,UAChDgT,EAAKS,YAAYd,EAAU3S,SAEzBgT,GAAmC,IAA3BA,EAAKU,WAAW3F,QAC1BiF,EAAK5I,SAEPuI,EAAU3S,QAAU,IAAI,CACzB,GACA,IAEH,MAAM2T,EAAUC,EAAAA,GAAyBlB,GACnCmB,EAAmCrR,EAAW,CAAC,EAAG,KAAO,CAAC,EAAG,KAC7DsR,GAAcC,EAAAA,EAAAA,UAClB,MACEzO,MAAOqO,EAAQ,gBACf9L,IAAK8L,EAAQ,cACb5H,aAAc4H,EAAQ,mBACtB3H,eAAgB2H,EAAQ,qBACxBpN,WAAYoN,EAAQ,iBACpB7M,WAAY6M,EAAQ,iBACpBjK,QAASiK,EAAQ,qBAEnB,CAACA,IAGH,OAAKf,GAAYD,EAAU3S,SAIpBgU,EAAAA,EAAAA,eACLC,EAAAA,EAAAA,KAAA,OACEC,UAAU,uBACVC,MAAO,CACL,uBAAoCR,EAAQ,iBAC5C,uBAAoCA,EAAQ,iBAC5C,uBAAoCnR,EAAW,OAAS,OACxD,qBAAkCmR,EAAQ,gBAC1C,uBAAoCA,EAAQ,0BAC5C,0BAAuCA,EAAQ,qBAC/C,4BAAyCnR,EAAW,OAAS,OAC7D,6BAA0CA,EAAW,OAAS,OAC9D,6BAA0CA,EAAW,UAAY,UAEnE4R,QAAS3B,EAAQ9I,UAEjB0K,EAAAA,EAAAA,MAAA,OAAKH,UAAU,oBAAoBE,QAAUE,GAAMA,EAAEC,kBAAkB5K,SAAA,EACrEsK,EAAAA,EAAAA,KAACO,EAAAA,GAAM,CACLN,UAAU,qBACVO,SAAUjS,EACVD,GAAI,CACFmS,WAAYlS,EACZmS,uBAAuB,EACvBC,OAAO,EACPC,gBAAiB,oBAEnBC,IAAKjB,EAAelK,UAEpBsK,EAAAA,EAAAA,KAACc,EAAU,CACTtS,OAAQqR,EACRnJ,kBAAmB4H,EACnB/P,SAAUA,OAId6R,EAAAA,EAAAA,MAAA,OAAKH,UAAU,sBAAqBvK,SAAA,CAAC,gBAAWgI,MAEhDsC,EAAAA,EAAAA,KAAA,OAAKC,UAAU,mBAAkBvK,SAAC,uBAElCsK,EAAAA,EAAAA,KAAA,OAAKC,UAAU,qBAAoBvK,UACjCsK,EAAAA,EAAAA,KAAA,UAAQrT,KAAK,SAASsT,UAAU,0BAA0BE,QAAS3B,EAAQ9I,SAAC,aAK9EsK,EAAAA,EAAAA,KAAA,UAAQrT,KAAK,SAASwT,QAAS3B,EAASyB,UAAU,2BAA0BvK,SAAC,cAKjFgJ,EAAU3S,SArDH,IAsDR,ECvHH,IAAIgV,GAAwB,EAErB,MAAMC,EAAqBA,KAC5BD,GAA2C,qBAAXpG,SACpCoG,GAAwB,EAGnBE,MAAM,sBAAsBC,OAAM,KAErCH,GAAwB,CAAK,IAC7B,C","sources":["features/bunny/bunnySceneMaterials.ts","features/bunny/useBunnyPointerInput.ts","features/bunny/useBunnyRuntimeLoop.ts","features/bunny/bunnySceneSetup.helpers.ts","features/bunny/useBunnySceneSetup.ts","features/bunny/BunnyScene.tsx","features/bunny/useCarrotStorage.ts","features/bunny/BunnyModal.tsx","features/bunny/preload.ts"],"sourcesContent":["import * as THREE from \"three\"\n\nexport const createOutlineMaterial = () =>\n  new THREE.ShaderMaterial({\n    uniforms: {\n      color: { value: new THREE.Color(0x000000) },\n      size: { value: 0.02 },\n      time: { value: 0.0 },\n    },\n    vertexShader: `\n      uniform float size;\n      uniform float time;\n\n      void main() {\n        vec3 transformed = position + normal * size * (1.0 + abs(sin(position.y * time * 0.02) * 2.0));\n        vec4 modelViewPosition = modelViewMatrix * vec4(transformed, 1.0);\n        gl_Position = projectionMatrix * modelViewPosition; \n      }\n    `,\n    fragmentShader: `\n      uniform vec3 color;\n      void main() {\n        gl_FragColor = vec4(color, 1.0);\n      }\n    `,\n    side: THREE.BackSide,\n  })\n\nexport const createFloorSimulationMaterial = () =>\n  new THREE.ShaderMaterial({\n    uniforms: {\n      inputTexture: { value: null },\n      time: { value: 0.0 },\n      blade1PosOld: { value: new THREE.Vector2(0.5, 0.5) },\n      blade1PosNew: { value: new THREE.Vector2(0.5, 0.5) },\n      strength: { value: 0.0 },\n    },\n    vertexShader: `\n      precision highp float;\n      uniform float time;\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n        gl_Position = projectionMatrix * modelViewPosition; \n      }\n    `,\n    fragmentShader: `\n      precision highp float;\n      uniform sampler2D inputTexture;\n      uniform vec2 blade1PosOld;\n      uniform vec2 blade1PosNew;\n      uniform float strength;\n      uniform float time;\n      varying vec2 vUv;\n\n      float lineSegment(vec2 p, vec2 a, vec2 b, float thickness) {\n          vec2 pa = p - a;\n          vec2 ba = b - a;\n          float h = clamp(dot(pa,ba)/dot(ba,ba), 0.0, 1.0);\n          float idk = length(pa - ba*h);\n          return smoothstep(thickness, 0.2 * thickness, idk);\n      }\n\n      void main(void) {\n        vec4 prevTexture = texture2D(inputTexture, vUv);\n        vec3 col = prevTexture.rgb * 0.999;\n        if (strength > 0.0) {\n            float space = 0.001;\n            float crease = 0.001;\n            float thickness = 0.001 + strength * 0.001;\n            float leftRed = lineSegment(vUv + space, blade1PosOld, blade1PosNew, thickness);\n            float leftGreen = lineSegment(vUv + space + crease, blade1PosOld, blade1PosNew, thickness);\n            float rightRed = lineSegment(vUv - space - crease, blade1PosOld, blade1PosNew, thickness);\n            float rightGreen = lineSegment(vUv - space, blade1PosOld, blade1PosNew, thickness);\n            col.r += (leftRed + rightRed) * strength * 3.0;\n            col.g += (leftGreen + rightGreen) * strength * 3.0;\n            col.r = clamp(col.r, 0.0, 1.0);\n            col.g = clamp(col.g, 0.0, 1.0);\n        }\n        gl_FragColor = vec4(col, 1.0);\n      }\n    `,\n  })\n\nexport class BufferSim {\n  renderer: THREE.WebGLRenderer\n  shader: THREE.ShaderMaterial\n  orthoScene: THREE.Scene\n  fbos: THREE.WebGLRenderTarget[]\n  current: number\n  output: THREE.WebGLRenderTarget\n  orthoCamera: THREE.OrthographicCamera\n  orthoQuad: THREE.Mesh\n\n  constructor(\n    renderer: THREE.WebGLRenderer,\n    width: number,\n    height: number,\n    shader: THREE.ShaderMaterial,\n  ) {\n    this.renderer = renderer\n    this.shader = shader\n    this.orthoScene = new THREE.Scene()\n\n    const fbo = new THREE.WebGLRenderTarget(width, height, {\n      wrapS: THREE.ClampToEdgeWrapping,\n      wrapT: THREE.ClampToEdgeWrapping,\n      minFilter: THREE.LinearFilter,\n      magFilter: THREE.LinearFilter,\n      format: THREE.RGBAFormat,\n      type: THREE.FloatType,\n      stencilBuffer: false,\n      depthBuffer: false,\n    })\n\n    fbo.texture.generateMipmaps = false\n\n    this.fbos = [fbo, fbo.clone()]\n    this.current = 0\n    this.output = this.fbos[0]\n    this.orthoCamera = new THREE.OrthographicCamera(\n      width / -2,\n      width / 2,\n      height / 2,\n      height / -2,\n      0.00001,\n      1000,\n    )\n    this.orthoQuad = new THREE.Mesh(new THREE.PlaneGeometry(width, height), this.shader)\n    this.orthoScene.add(this.orthoQuad)\n  }\n\n  render() {\n    this.shader.uniforms.inputTexture.value = this.fbos[this.current].texture\n    this.current = 1 - this.current\n    this.output = this.fbos[this.current]\n    this.renderer.setRenderTarget(this.output)\n    this.renderer.render(this.orthoScene, this.orthoCamera)\n    this.renderer.setRenderTarget(null)\n  }\n\n  dispose() {\n    this.orthoQuad.geometry.dispose()\n    this.fbos.forEach((fbo) => fbo.dispose())\n  }\n}\n","import { useEffect, type MutableRefObject } from \"react\"\nimport * as THREE from \"three\"\n\ninterface BunnyPointerInputOptions {\n  mouseRef: MutableRefObject<THREE.Vector2>\n  rabbitRef: MutableRefObject<THREE.Group | null>\n  isJumping: boolean\n  onJump: () => void\n}\n\nexport const useBunnyPointerInput = ({\n  mouseRef,\n  rabbitRef,\n  isJumping,\n  onJump,\n}: BunnyPointerInputOptions) => {\n  useEffect(() => {\n    const handleMouseMove = (event: MouseEvent) => {\n      mouseRef.current.x = (event.clientX / window.innerWidth) * 2 - 1\n      mouseRef.current.y = -(event.clientY / window.innerHeight) * 2 + 1\n    }\n\n    const handleTouchMove = (event: TouchEvent) => {\n      if (event.touches.length !== 1) return\n      event.preventDefault()\n      mouseRef.current.x = (event.touches[0].clientX / window.innerWidth) * 2 - 1\n      mouseRef.current.y = -(event.touches[0].clientY / window.innerHeight) * 2 + 1\n    }\n\n    const handlePress = () => {\n      if (rabbitRef.current && !isJumping) {\n        onJump()\n      }\n    }\n\n    window.addEventListener(\"mousemove\", handleMouseMove)\n    window.addEventListener(\"touchmove\", handleTouchMove, { passive: false })\n    window.addEventListener(\"mousedown\", handlePress)\n    window.addEventListener(\"touchstart\", handlePress)\n\n    return () => {\n      window.removeEventListener(\"mousemove\", handleMouseMove)\n      window.removeEventListener(\"touchmove\", handleTouchMove)\n      window.removeEventListener(\"mousedown\", handlePress)\n      window.removeEventListener(\"touchstart\", handlePress)\n    }\n  }, [isJumping, mouseRef, onJump, rabbitRef])\n}\n","import { useFrame } from \"@react-three/fiber\"\nimport type { MutableRefObject } from \"react\"\nimport * as THREE from \"three\"\nimport { Reflector } from \"three/examples/jsm/objects/Reflector.js\"\nimport { BufferSim } from \"./bunnySceneMaterials\"\n\nconst getShortestAngle = (v: number) => {\n  let a = v % (Math.PI * 2)\n  if (a < -Math.PI) a += Math.PI * 2\n  else if (a > Math.PI) a -= Math.PI * 2\n  return a\n}\n\nconst constrain = (v: number, vMin: number, vMax: number) => Math.min(vMax, Math.max(vMin, v))\n\ninterface BunnyRuntimeLoopOptions {\n  modelLoaded: boolean\n  isMobile: boolean\n  isJumping: boolean\n  camera: THREE.Camera\n  timeRef: MutableRefObject<number>\n  outlineMatRef: MutableRefObject<THREE.ShaderMaterial>\n  rabbitRef: MutableRefObject<THREE.Group | null>\n  earLeftRef: MutableRefObject<THREE.Object3D | null>\n  earRightRef: MutableRefObject<THREE.Object3D | null>\n  carrotRef: MutableRefObject<THREE.Object3D | null>\n  floorRef: MutableRefObject<Reflector | null>\n  lineRef: MutableRefObject<THREE.Line | null>\n  floorSimMatRef: MutableRefObject<THREE.ShaderMaterial | null>\n  bufferSimRef: MutableRefObject<BufferSim | null>\n  floorSizeRef: MutableRefObject<number>\n  mouseRef: MutableRefObject<THREE.Vector2>\n  raycasterRef: MutableRefObject<THREE.Raycaster>\n  heroSpeedRef: MutableRefObject<THREE.Vector2>\n  heroOldRotRef: MutableRefObject<number>\n  heroAngularSpeedRef: MutableRefObject<number>\n  heroOldUVPosRef: MutableRefObject<THREE.Vector2>\n  heroNewUVPosRef: MutableRefObject<THREE.Vector2>\n  targetHeroUVPosRef: MutableRefObject<THREE.Vector2>\n  targetHeroAbsPosRef: MutableRefObject<THREE.Vector2>\n  onCollisionCheck: () => void\n}\n\ntype ShaderUniformMap = Record<string, { value: unknown } | undefined>\n\nexport const useBunnyRuntimeLoop = ({\n  modelLoaded,\n  isMobile,\n  isJumping,\n  camera,\n  timeRef,\n  outlineMatRef,\n  rabbitRef,\n  earLeftRef,\n  earRightRef,\n  carrotRef,\n  floorRef,\n  lineRef,\n  floorSimMatRef,\n  bufferSimRef,\n  floorSizeRef,\n  mouseRef,\n  raycasterRef,\n  heroSpeedRef,\n  heroOldRotRef,\n  heroAngularSpeedRef,\n  heroOldUVPosRef,\n  heroNewUVPosRef,\n  targetHeroUVPosRef,\n  targetHeroAbsPosRef,\n  onCollisionCheck,\n}: BunnyRuntimeLoopOptions) => {\n  useFrame((_, delta) => {\n    if (!modelLoaded) return\n\n    const dt = Math.min(delta, 0.3)\n    timeRef.current += dt\n    outlineMatRef.current.uniforms.time.value = timeRef.current\n\n    if (\n      !rabbitRef.current ||\n      !lineRef.current ||\n      !floorRef.current\n    ) {\n      return\n    }\n\n    raycasterRef.current.setFromCamera(mouseRef.current, camera)\n    const intersects = raycasterRef.current.intersectObject(floorRef.current)\n\n    if (intersects.length > 0 && intersects[0].uv) {\n      targetHeroUVPosRef.current.x = intersects[0].uv.x\n      targetHeroUVPosRef.current.y = intersects[0].uv.y\n    }\n\n    const clampRange = isMobile ? 0.22 : 0.3\n    const constrainUVPosX = constrain(targetHeroUVPosRef.current.x - 0.5, -clampRange, clampRange)\n    const constrainUVPosY = constrain(targetHeroUVPosRef.current.y - 0.5, -clampRange, clampRange)\n    targetHeroAbsPosRef.current.x = constrainUVPosX * floorSizeRef.current\n    targetHeroAbsPosRef.current.y = -constrainUVPosY * floorSizeRef.current\n\n    const dx = targetHeroAbsPosRef.current.x - rabbitRef.current.position.x\n    const dy = targetHeroAbsPosRef.current.y - rabbitRef.current.position.z\n\n    const angle = Math.atan2(dy, dx)\n    const heroDistance = Math.sqrt(dx * dx + dy * dy)\n    const ax = dx * dt * 0.3\n    const ay = dy * dt * 0.3\n\n    heroSpeedRef.current.x += ax\n    heroSpeedRef.current.y += ay\n    heroSpeedRef.current.x *= Math.pow(dt, 0.005)\n    heroSpeedRef.current.y *= Math.pow(dt, 0.005)\n\n    rabbitRef.current.position.x += heroSpeedRef.current.x\n    rabbitRef.current.position.z += heroSpeedRef.current.y\n\n    const targetRot = -angle + Math.PI / 2\n    if (heroDistance > 0.3) {\n      rabbitRef.current.rotation.y +=\n        getShortestAngle(targetRot - rabbitRef.current.rotation.y) * 3 * dt\n    }\n\n    heroAngularSpeedRef.current = getShortestAngle(\n      rabbitRef.current.rotation.y - heroOldRotRef.current,\n    )\n    heroOldRotRef.current = rabbitRef.current.rotation.y\n\n    if (!isJumping && earLeftRef.current && earRightRef.current) {\n      earLeftRef.current.rotation.x = earRightRef.current.rotation.x =\n        -heroSpeedRef.current.length() * 2\n    }\n\n    const linePositions = (lineRef.current.geometry as THREE.BufferGeometry).attributes.position\n      .array\n    linePositions[0] = targetHeroAbsPosRef.current.x\n    linePositions[2] = targetHeroAbsPosRef.current.y\n    linePositions[3] = rabbitRef.current.position.x\n    linePositions[4] = rabbitRef.current.position.y\n    linePositions[5] = rabbitRef.current.position.z\n    ;(lineRef.current.geometry as THREE.BufferGeometry).attributes.position.needsUpdate = true\n    lineRef.current.computeLineDistances()\n\n    heroNewUVPosRef.current.x = 0.5 + rabbitRef.current.position.x / floorSizeRef.current\n    heroNewUVPosRef.current.y = 0.5 - rabbitRef.current.position.z / floorSizeRef.current\n\n    if (floorRef.current.material instanceof THREE.ShaderMaterial) {\n      const uniforms = floorRef.current.material.uniforms as ShaderUniformMap\n      const scratchUniform = uniforms.tScratches\n\n      if (scratchUniform && floorSimMatRef.current && bufferSimRef.current) {\n        floorSimMatRef.current.uniforms.time.value += dt\n        floorSimMatRef.current.uniforms.blade1PosNew.value = heroNewUVPosRef.current\n        floorSimMatRef.current.uniforms.blade1PosOld.value = heroOldUVPosRef.current\n        floorSimMatRef.current.uniforms.strength.value = isJumping\n          ? 0\n          : 1 / (1 + heroSpeedRef.current.length() * 10)\n\n        bufferSimRef.current.render()\n        scratchUniform.value = bufferSimRef.current.output.texture\n      }\n    }\n\n    heroOldUVPosRef.current.copy(heroNewUVPosRef.current)\n\n    if (carrotRef.current) {\n      carrotRef.current.rotation.y += dt\n    }\n\n    onCollisionCheck()\n  })\n}\n","import type { Dispatch, MutableRefObject, SetStateAction } from \"react\"\nimport * as THREE from \"three\"\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader.js\"\nimport { Reflector } from \"three/examples/jsm/objects/Reflector.js\"\nimport { BufferSim, createFloorSimulationMaterial } from \"./bunnySceneMaterials\"\nimport type { BunnySceneColors } from \"./bunnyScene.types\"\n\nconst CARROT_MARKER_Y_OFFSET = 0.01\n\nexport type AddToScene = <T extends THREE.Object3D>(object: T) => T\n\nexport interface BunnyMaterialRefs {\n  primMatRef: MutableRefObject<THREE.MeshToonMaterial>\n  secMatRef: MutableRefObject<THREE.MeshToonMaterial>\n  bonusMatRef: MutableRefObject<THREE.MeshToonMaterial>\n  leafMatRef: MutableRefObject<THREE.MeshToonMaterial>\n  outlineMatRef: MutableRefObject<THREE.ShaderMaterial>\n}\n\nexport interface BunnyScaffoldResources {\n  floorSimMat: THREE.ShaderMaterial | null\n  lineMaterial: THREE.LineDashedMaterial\n  lineGeometry: THREE.BufferGeometry\n  particleGeom: THREE.BoxGeometry\n}\n\ninterface CreateBunnySceneScaffoldOptions {\n  gl: THREE.WebGLRenderer\n  isMobile: boolean\n  colors: BunnySceneColors\n  floorSizeRef: MutableRefObject<number>\n  lineRef: MutableRefObject<THREE.Line | null>\n  floorRef: MutableRefObject<Reflector | null>\n  carrotMarkerRef: MutableRefObject<THREE.Mesh | null>\n  carrotMarkerDotRef: MutableRefObject<THREE.Mesh | null>\n  bufferSimRef: MutableRefObject<BufferSim | null>\n  floorSimMatRef: MutableRefObject<THREE.ShaderMaterial | null>\n  particlesRef: MutableRefObject<THREE.Mesh[]>\n  particles2Ref: MutableRefObject<THREE.Mesh[]>\n  primMatRef: MutableRefObject<THREE.MeshToonMaterial>\n  bonusMatRef: MutableRefObject<THREE.MeshToonMaterial>\n  addToScene: AddToScene\n}\n\ninterface RabbitModelParts {\n  rabbit: THREE.Group\n  rabbitBody: THREE.Mesh\n  earRight: THREE.Mesh\n  earLeft: THREE.Mesh\n  tail: THREE.Mesh\n  footLeft: THREE.Mesh\n  footRight: THREE.Mesh\n  eyeLeft: THREE.Mesh\n  eyeRight: THREE.Mesh\n  carrot: THREE.Mesh\n  carrotLeaf: THREE.Mesh\n  carrotLeaf2: THREE.Mesh\n}\n\ninterface LoadRabbitModelIntoSceneOptions extends BunnyMaterialRefs {\n  addToScene: AddToScene\n  disposedRef: MutableRefObject<boolean>\n  setModelLoaded: Dispatch<SetStateAction<boolean>>\n  rabbitRef: MutableRefObject<THREE.Group | null>\n  rabbitBodyRef: MutableRefObject<THREE.Object3D | null>\n  earLeftRef: MutableRefObject<THREE.Object3D | null>\n  earRightRef: MutableRefObject<THREE.Object3D | null>\n  carrotRef: MutableRefObject<THREE.Object3D | null>\n}\n\nconst applyRabbitMaterialsAndOutlines = (\n  parts: RabbitModelParts,\n  { primMatRef, secMatRef, bonusMatRef, leafMatRef, outlineMatRef }: BunnyMaterialRefs,\n) => {\n  parts.carrot.rotation.z = 0.2\n  parts.carrot.rotation.x = 0.2\n\n  parts.rabbitBody.material = primMatRef.current\n  parts.earRight.material = primMatRef.current\n  parts.earLeft.material = primMatRef.current\n  parts.tail.material = primMatRef.current\n  parts.footLeft.material = secMatRef.current\n  parts.footRight.material = secMatRef.current\n  parts.eyeLeft.material = secMatRef.current\n  parts.eyeRight.material = secMatRef.current\n  parts.carrot.material = bonusMatRef.current\n  parts.carrotLeaf.material = leafMatRef.current\n  parts.carrotLeaf2.material = leafMatRef.current\n\n  const addOutline = (obj: THREE.Object3D) => {\n    const outline = obj.clone() as THREE.Mesh\n    outline.children = []\n    outline.position.set(0, 0, 0)\n    outline.rotation.set(0, 0, 0)\n    outline.scale.set(1, 1, 1)\n    outline.material = outlineMatRef.current\n    obj.add(outline)\n  }\n\n  addOutline(parts.rabbitBody)\n  addOutline(parts.earRight)\n  addOutline(parts.earLeft)\n  addOutline(parts.tail)\n  addOutline(parts.carrot)\n\n  parts.rabbit.traverse((object) => {\n    if ((object as THREE.Mesh).isMesh) {\n      object.castShadow = true\n      object.receiveShadow = true\n    }\n  })\n\n  parts.carrot.traverse((object) => {\n    if ((object as THREE.Mesh).isMesh) {\n      object.castShadow = true\n    }\n  })\n}\n\nexport const loadRabbitModelIntoScene = ({\n  addToScene,\n  disposedRef,\n  setModelLoaded,\n  rabbitRef,\n  rabbitBodyRef,\n  earLeftRef,\n  earRightRef,\n  carrotRef,\n  ...materialRefs\n}: LoadRabbitModelIntoSceneOptions) => {\n  const loader = new GLTFLoader()\n\n  loader.load(\"/models/rabbit.glb\", (gltf) => {\n    if (disposedRef.current) return\n\n    const model = gltf.scene\n    const rabbit = model.getObjectByName(\"Rabbit\") as THREE.Group | null\n    const rabbitBody = model.getObjectByName(\"body\") as THREE.Mesh | null\n    const earRight = model.getObjectByName(\"earRight\") as THREE.Mesh | null\n    const earLeft = model.getObjectByName(\"earLeft\") as THREE.Mesh | null\n    const tail = model.getObjectByName(\"tail\") as THREE.Mesh | null\n    const footLeft = model.getObjectByName(\"footLeft\") as THREE.Mesh | null\n    const footRight = model.getObjectByName(\"footRight\") as THREE.Mesh | null\n    const eyeLeft = model.getObjectByName(\"eyeLeft\") as THREE.Mesh | null\n    const eyeRight = model.getObjectByName(\"eyeRight\") as THREE.Mesh | null\n    const carrot = model.getObjectByName(\"carrot\") as THREE.Mesh | null\n    const carrotLeaf = model.getObjectByName(\"carrotLeaf\") as THREE.Mesh | null\n    const carrotLeaf2 = model.getObjectByName(\"carrotLeaf2\") as THREE.Mesh | null\n\n    if (\n      !rabbit ||\n      !rabbitBody ||\n      !earRight ||\n      !earLeft ||\n      !tail ||\n      !footLeft ||\n      !footRight ||\n      !eyeLeft ||\n      !eyeRight ||\n      !carrot ||\n      !carrotLeaf ||\n      !carrotLeaf2\n    ) {\n      return\n    }\n\n    const parts: RabbitModelParts = {\n      rabbit,\n      rabbitBody,\n      earRight,\n      earLeft,\n      tail,\n      footLeft,\n      footRight,\n      eyeLeft,\n      eyeRight,\n      carrot,\n      carrotLeaf,\n      carrotLeaf2,\n    }\n\n    applyRabbitMaterialsAndOutlines(parts, materialRefs)\n\n    addToScene(rabbit)\n    addToScene(carrot)\n\n    rabbitRef.current = rabbit\n    rabbitBodyRef.current = rabbitBody\n    earLeftRef.current = earLeft\n    earRightRef.current = earRight\n    carrotRef.current = carrot\n\n    setModelLoaded(true)\n  })\n}\n\nexport const createBunnySceneScaffold = ({\n  gl,\n  isMobile,\n  colors,\n  floorSizeRef,\n  lineRef,\n  floorRef,\n  carrotMarkerRef,\n  carrotMarkerDotRef,\n  bufferSimRef,\n  floorSimMatRef,\n  particlesRef,\n  particles2Ref,\n  primMatRef,\n  bonusMatRef,\n  addToScene,\n}: CreateBunnySceneScaffoldOptions): BunnyScaffoldResources => {\n  const reflectorTextureSize = isMobile ? 384 : 640\n  let floorSimMat: THREE.ShaderMaterial | null = null\n  floorSimMatRef.current = null\n  bufferSimRef.current = null\n\n  const lineMaterial = new THREE.LineDashedMaterial({\n    color: 0x7beeff,\n    linewidth: 1,\n    scale: 1,\n    dashSize: 0.2,\n    gapSize: 0.1,\n  })\n\n  const lineGeometry = new THREE.BufferGeometry().setFromPoints([\n    new THREE.Vector3(0, 0.2, 0),\n    new THREE.Vector3(3, 0.2, 3),\n  ])\n  const line = addToScene(new THREE.Line(lineGeometry, lineMaterial))\n  lineRef.current = line\n\n  const particleGeom = new THREE.BoxGeometry(0.2, 0.2, 0.2, 1, 1, 1)\n  const particles1: THREE.Mesh[] = []\n  const particles2: THREE.Mesh[] = []\n\n  for (let i = 0; i < 20; i++) {\n    const mesh = new THREE.Mesh(particleGeom, bonusMatRef.current)\n    mesh.scale.set(0, 0, 0)\n    particles1.push(addToScene(mesh))\n  }\n\n  for (let i = 0; i < 5; i++) {\n    const mesh = new THREE.Mesh(particleGeom, primMatRef.current)\n    mesh.scale.set(0, 0, 0)\n    particles2.push(addToScene(mesh))\n  }\n\n  particlesRef.current = particles1\n  particles2Ref.current = particles2\n\n  addToScene(new THREE.AmbientLight(0xffffff))\n\n  const directionalLight = new THREE.DirectionalLight(0xffffff, 1)\n  directionalLight.position.set(1, 5, 1)\n  directionalLight.castShadow = !isMobile\n  directionalLight.shadow.mapSize.width = 512\n  directionalLight.shadow.mapSize.height = 512\n  directionalLight.shadow.camera.near = 0.5\n  directionalLight.shadow.camera.far = 12\n  directionalLight.shadow.camera.left = -12\n  directionalLight.shadow.camera.right = 12\n  directionalLight.shadow.camera.bottom = -12\n  directionalLight.shadow.camera.top = 12\n  directionalLight.shadow.radius = 3\n  directionalLight.shadow.blurSamples = 4\n  addToScene(directionalLight)\n\n  const floor = addToScene(\n    new Reflector(new THREE.PlaneGeometry(floorSizeRef.current, floorSizeRef.current), {\n      color: new THREE.Color(colors.floor),\n      textureWidth: reflectorTextureSize,\n      textureHeight: reflectorTextureSize,\n    }),\n  )\n  floor.rotation.x = -Math.PI / 2\n  floor.receiveShadow = true\n  floorRef.current = floor\n\n  if (floor.material instanceof THREE.ShaderMaterial && floor.material.uniforms.tScratches) {\n    const simTextureSize = isMobile ? 384 : 640\n    floorSimMat = createFloorSimulationMaterial()\n    floorSimMatRef.current = floorSimMat\n    bufferSimRef.current = new BufferSim(gl, simTextureSize, simTextureSize, floorSimMat)\n  }\n\n  const carrotMarker = addToScene(\n    new THREE.Mesh(\n      new THREE.RingGeometry(0.25, 0.35, 32),\n      new THREE.MeshBasicMaterial({\n        color: new THREE.Color(colors.carrotBody),\n        transparent: true,\n        opacity: 0.65,\n        side: THREE.DoubleSide,\n      }),\n    ),\n  )\n  carrotMarker.rotation.x = -Math.PI / 2\n  carrotMarker.position.y = CARROT_MARKER_Y_OFFSET\n  carrotMarker.visible = false\n  carrotMarkerRef.current = carrotMarker\n\n  const carrotMarkerDot = addToScene(\n    new THREE.Mesh(\n      new THREE.CircleGeometry(0.07, 24),\n      new THREE.MeshBasicMaterial({\n        color: new THREE.Color(colors.carrotLeaf),\n        side: THREE.DoubleSide,\n      }),\n    ),\n  )\n  carrotMarkerDot.rotation.x = -Math.PI / 2\n  carrotMarkerDot.position.y = CARROT_MARKER_Y_OFFSET + 0.005\n  carrotMarkerDot.visible = false\n  carrotMarkerDotRef.current = carrotMarkerDot\n\n  return {\n    floorSimMat,\n    lineMaterial,\n    lineGeometry,\n    particleGeom,\n  }\n}\n","import { useEffect, type Dispatch, type MutableRefObject, type SetStateAction } from \"react\"\nimport * as THREE from \"three\"\nimport { Reflector } from \"three/examples/jsm/objects/Reflector.js\"\nimport { BufferSim } from \"./bunnySceneMaterials\"\nimport {\n  createBunnySceneScaffold,\n  loadRabbitModelIntoScene,\n  type AddToScene,\n  type BunnyMaterialRefs,\n} from \"./bunnySceneSetup.helpers\"\nimport type { BunnySceneColors } from \"./bunnyScene.types\"\n\nconst disposeObjectGeometries = (objects: THREE.Object3D[]) => {\n  const geometries = new Set<THREE.BufferGeometry>()\n\n  objects.forEach((object) => {\n    object.traverse((child) => {\n      if ((child as THREE.Mesh).isMesh || (child as THREE.Line).isLine) {\n        const geometry = (child as THREE.Mesh | THREE.Line).geometry\n        if (geometry) {\n          geometries.add(geometry)\n        }\n      }\n    })\n  })\n\n  geometries.forEach((geometry) => geometry.dispose())\n}\n\ninterface BunnySceneSetupOptions extends BunnyMaterialRefs {\n  scene: THREE.Scene\n  camera: THREE.Camera\n  gl: THREE.WebGLRenderer\n  isMobile: boolean\n  colors: BunnySceneColors\n  setModelLoaded: Dispatch<SetStateAction<boolean>>\n  floorSizeRef: MutableRefObject<number>\n  rabbitRef: MutableRefObject<THREE.Group | null>\n  rabbitBodyRef: MutableRefObject<THREE.Object3D | null>\n  earLeftRef: MutableRefObject<THREE.Object3D | null>\n  earRightRef: MutableRefObject<THREE.Object3D | null>\n  carrotRef: MutableRefObject<THREE.Object3D | null>\n  carrotMarkerRef: MutableRefObject<THREE.Mesh | null>\n  carrotMarkerDotRef: MutableRefObject<THREE.Mesh | null>\n  floorRef: MutableRefObject<Reflector | null>\n  lineRef: MutableRefObject<THREE.Line | null>\n  bufferSimRef: MutableRefObject<BufferSim | null>\n  floorSimMatRef: MutableRefObject<THREE.ShaderMaterial | null>\n  particlesRef: MutableRefObject<THREE.Mesh[]>\n  particles2Ref: MutableRefObject<THREE.Mesh[]>\n}\n\nexport const useBunnySceneSetup = ({\n  scene,\n  camera,\n  gl,\n  isMobile,\n  colors,\n  setModelLoaded,\n  floorSizeRef,\n  rabbitRef,\n  rabbitBodyRef,\n  earLeftRef,\n  earRightRef,\n  carrotRef,\n  carrotMarkerRef,\n  carrotMarkerDotRef,\n  floorRef,\n  lineRef,\n  bufferSimRef,\n  floorSimMatRef,\n  particlesRef,\n  particles2Ref,\n  primMatRef,\n  secMatRef,\n  bonusMatRef,\n  leafMatRef,\n  outlineMatRef,\n}: BunnySceneSetupOptions) => {\n  useEffect(() => {\n    scene.fog = new THREE.Fog(new THREE.Color(colors.fog).getHex(), 13, 20)\n    camera.position.set(0, 4, 8)\n    camera.lookAt(0, 0, 0)\n\n    const createdObjects: THREE.Object3D[] = []\n    const disposedRef = { current: false }\n\n    const addToScene: AddToScene = (object) => {\n      scene.add(object)\n      createdObjects.push(object)\n      return object\n    }\n\n    const { floorSimMat, lineMaterial, lineGeometry, particleGeom } = createBunnySceneScaffold({\n      gl,\n      isMobile,\n      colors,\n      floorSizeRef,\n      lineRef,\n      floorRef,\n      carrotMarkerRef,\n      carrotMarkerDotRef,\n      bufferSimRef,\n      floorSimMatRef,\n      particlesRef,\n      particles2Ref,\n      primMatRef,\n      bonusMatRef,\n      addToScene,\n    })\n\n    loadRabbitModelIntoScene({\n      addToScene,\n      disposedRef,\n      setModelLoaded,\n      rabbitRef,\n      rabbitBodyRef,\n      earLeftRef,\n      earRightRef,\n      carrotRef,\n      primMatRef,\n      secMatRef,\n      bonusMatRef,\n      leafMatRef,\n      outlineMatRef,\n    })\n\n    return () => {\n      disposedRef.current = true\n      setModelLoaded(false)\n\n      ;(floorRef.current as (Reflector & { dispose?: () => void }) | null)?.dispose?.()\n\n      createdObjects.forEach((object) => {\n        if (object.parent === scene) {\n          scene.remove(object)\n        }\n      })\n\n      disposeObjectGeometries(createdObjects)\n      lineGeometry.dispose()\n      lineMaterial.dispose()\n      particleGeom.dispose()\n      floorSimMat?.dispose()\n      bufferSimRef.current?.dispose()\n\n      lineRef.current = null\n      floorRef.current = null\n      carrotMarkerRef.current = null\n      carrotMarkerDotRef.current = null\n      rabbitRef.current = null\n      rabbitBodyRef.current = null\n      earLeftRef.current = null\n      earRightRef.current = null\n      carrotRef.current = null\n      particlesRef.current = []\n      particles2Ref.current = []\n      floorSimMatRef.current = null\n      bufferSimRef.current = null\n    }\n  }, [\n    bonusMatRef,\n    bufferSimRef,\n    camera,\n    carrotMarkerDotRef,\n    carrotMarkerRef,\n    carrotRef,\n    colors,\n    earLeftRef,\n    earRightRef,\n    floorRef,\n    floorSimMatRef,\n    floorSizeRef,\n    gl,\n    isMobile,\n    leafMatRef,\n    lineRef,\n    outlineMatRef,\n    particles2Ref,\n    particlesRef,\n    primMatRef,\n    rabbitBodyRef,\n    rabbitRef,\n    scene,\n    secMatRef,\n    setModelLoaded,\n  ])\n}\n","import type React from \"react\"\nimport { useCallback, useEffect, useRef, useState } from \"react\"\nimport { useThree } from \"@react-three/fiber\"\nimport * as THREE from \"three\"\nimport { Reflector } from \"three/examples/jsm/objects/Reflector.js\"\nimport gsap from \"gsap\"\nimport { BufferSim, createOutlineMaterial } from \"./bunnySceneMaterials\"\nimport type { BunnySceneColors, BunnySceneProps } from \"./bunnyScene.types\"\nimport { useBunnyPointerInput } from \"./useBunnyPointerInput\"\nimport { useBunnyRuntimeLoop } from \"./useBunnyRuntimeLoop\"\nimport { useBunnySceneSetup } from \"./useBunnySceneSetup\"\n\nexport type { BunnySceneColors }\n\nconst HIGH_CARROT_HEIGHT_THRESHOLD = 0.85\nconst CARROT_MARKER_Y_OFFSET = 0.01\n\nconst BunnyScene: React.FC<BunnySceneProps> = ({ colors, onCarrotCollected, isMobile }) => {\n  const { scene, gl, camera } = useThree()\n  const [modelLoaded, setModelLoaded] = useState(false)\n  const [isJumping, setIsJumping] = useState(false)\n\n  const rabbitRef = useRef<THREE.Group | null>(null)\n  const rabbitBodyRef = useRef<THREE.Object3D | null>(null)\n  const earLeftRef = useRef<THREE.Object3D | null>(null)\n  const earRightRef = useRef<THREE.Object3D | null>(null)\n  const carrotRef = useRef<THREE.Object3D | null>(null)\n  const carrotMarkerRef = useRef<THREE.Mesh | null>(null)\n  const carrotMarkerDotRef = useRef<THREE.Mesh | null>(null)\n  const floorRef = useRef<Reflector | null>(null)\n  const lineRef = useRef<THREE.Line | null>(null)\n  const bufferSimRef = useRef<BufferSim | null>(null)\n  const floorSimMatRef = useRef<THREE.ShaderMaterial | null>(null)\n  const particlesRef = useRef<THREE.Mesh[]>([])\n  const particles2Ref = useRef<THREE.Mesh[]>([])\n\n  const heroSpeedRef = useRef(new THREE.Vector2(0, 0))\n  const heroOldRotRef = useRef(0)\n  const heroAngularSpeedRef = useRef(0)\n  const heroOldUVPosRef = useRef(new THREE.Vector2(0.5, 0.5))\n  const heroNewUVPosRef = useRef(new THREE.Vector2(0.5, 0.5))\n  const targetHeroUVPosRef = useRef(new THREE.Vector2(0.5, 0.5))\n  const targetHeroAbsPosRef = useRef(new THREE.Vector2(0, 0))\n  const jumpParamsRef = useRef({ jumpProgress: 0 })\n  const isExplodingRef = useRef(false)\n  const mouseRef = useRef(new THREE.Vector2())\n  const raycasterRef = useRef(new THREE.Raycaster())\n  const floorSizeRef = useRef(30)\n  const timeRef = useRef(0)\n\n  const primMatRef = useRef<THREE.MeshToonMaterial>(\n    new THREE.MeshToonMaterial({ color: new THREE.Color(colors.bunnyPrimary) }),\n  )\n  const secMatRef = useRef<THREE.MeshToonMaterial>(\n    new THREE.MeshToonMaterial({ color: new THREE.Color(colors.bunnySecondary) }),\n  )\n  const bonusMatRef = useRef<THREE.MeshToonMaterial>(\n    new THREE.MeshToonMaterial({ color: new THREE.Color(colors.carrotBody) }),\n  )\n  const leafMatRef = useRef<THREE.MeshToonMaterial>(\n    new THREE.MeshToonMaterial({ color: new THREE.Color(colors.carrotLeaf) }),\n  )\n  const outlineMatRef = useRef<THREE.ShaderMaterial>(createOutlineMaterial())\n\n  useEffect(() => {\n    primMatRef.current.color.set(colors.bunnyPrimary)\n    secMatRef.current.color.set(colors.bunnySecondary)\n    bonusMatRef.current.color.set(colors.carrotBody)\n    leafMatRef.current.color.set(colors.carrotLeaf)\n    outlineMatRef.current.uniforms.color.value = new THREE.Color(colors.outline)\n    scene.fog = new THREE.Fog(new THREE.Color(colors.fog).getHex(), 13, 20)\n\n    if (floorRef.current) {\n      const mat = floorRef.current.material as THREE.Material & {\n        color?: THREE.Color\n        uniforms?: Record<string, { value: THREE.Color }>\n      }\n      if (mat.color) {\n        mat.color.set(colors.floor)\n      } else if (mat.uniforms?.color) {\n        mat.uniforms.color.value.set(new THREE.Color(colors.floor))\n      }\n    }\n\n    if (carrotMarkerRef.current) {\n      const markerMat = carrotMarkerRef.current.material as THREE.MeshBasicMaterial\n      markerMat.color.set(colors.carrotBody)\n    }\n\n    if (carrotMarkerDotRef.current) {\n      const markerDotMat = carrotMarkerDotRef.current.material as THREE.MeshBasicMaterial\n      markerDotMat.color.set(colors.carrotLeaf)\n    }\n  }, [colors, scene])\n\n  useBunnySceneSetup({\n    scene,\n    camera,\n    gl,\n    isMobile,\n    colors,\n    setModelLoaded,\n    floorSizeRef,\n    rabbitRef,\n    rabbitBodyRef,\n    earLeftRef,\n    earRightRef,\n    carrotRef,\n    carrotMarkerRef,\n    carrotMarkerDotRef,\n    floorRef,\n    lineRef,\n    bufferSimRef,\n    floorSimMatRef,\n    particlesRef,\n    particles2Ref,\n    primMatRef,\n    secMatRef,\n    bonusMatRef,\n    leafMatRef,\n    outlineMatRef,\n  })\n\n  useEffect(() => {\n    const jumpParams = jumpParamsRef.current\n    const primMat = primMatRef.current\n    const secMat = secMatRef.current\n    const bonusMat = bonusMatRef.current\n    const leafMat = leafMatRef.current\n    const outlineMat = outlineMatRef.current\n\n    return () => {\n      gsap.killTweensOf(jumpParams)\n      primMat.dispose()\n      secMat.dispose()\n      bonusMat.dispose()\n      leafMat.dispose()\n      outlineMat.dispose()\n    }\n  }, [])\n\n  const hideCarrotMarker = useCallback(() => {\n    if (carrotMarkerRef.current) carrotMarkerRef.current.visible = false\n    if (carrotMarkerDotRef.current) carrotMarkerDotRef.current.visible = false\n  }, [])\n\n  const spawnCarrot = useCallback(() => {\n    if (!carrotRef.current) return\n\n    hideCarrotMarker()\n\n    const spawnRange = isMobile ? 0.24 : 0.3\n    const px = (Math.random() - 0.5) * spawnRange\n    const py = (Math.random() - 0.5) * spawnRange\n    const h = 0.2 + Math.random() * 1\n    const spawnX = px * floorSizeRef.current\n    const spawnZ = py * floorSizeRef.current\n\n    carrotRef.current.position.x = spawnX\n    carrotRef.current.position.z = spawnZ\n    carrotRef.current.position.y = -1\n\n    carrotRef.current.scale.set(0, 0, 0)\n    carrotRef.current.visible = true\n\n    if (h > HIGH_CARROT_HEIGHT_THRESHOLD && carrotMarkerRef.current && carrotMarkerDotRef.current) {\n      carrotMarkerRef.current.visible = true\n      carrotMarkerDotRef.current.visible = true\n      carrotMarkerRef.current.position.set(spawnX, CARROT_MARKER_Y_OFFSET, spawnZ)\n      carrotMarkerDotRef.current.position.set(spawnX, CARROT_MARKER_Y_OFFSET + 0.005, spawnZ)\n      carrotMarkerRef.current.scale.set(0.4, 0.4, 0.4)\n      carrotMarkerDotRef.current.scale.set(0, 0, 0)\n\n      gsap.to(carrotMarkerRef.current.scale, {\n        duration: 0.8,\n        ease: \"elastic.out\",\n        x: 1,\n        y: 1,\n        z: 1,\n      })\n\n      gsap.to(carrotMarkerDotRef.current.scale, {\n        duration: 0.6,\n        ease: \"back.out(1.7)\",\n        x: 1,\n        y: 1,\n        z: 1,\n      })\n    }\n\n    gsap.to(carrotRef.current.scale, {\n      duration: 1.5,\n      ease: \"elastic.out\",\n      x: 1,\n      y: 1,\n      z: 1,\n    })\n\n    gsap.to(carrotRef.current.position, {\n      duration: 1.5,\n      ease: \"elastic.out\",\n      y: h,\n    })\n  }, [hideCarrotMarker, isMobile])\n\n  const explode = useCallback(\n    (pos: THREE.Vector3) => {\n      isExplodingRef.current = true\n\n      for (const mesh of particlesRef.current) {\n        mesh.position.set(pos.x, pos.y, pos.z)\n        mesh.scale.set(2, 2, 2)\n\n        gsap.to(mesh.position, {\n          x: pos.x + (-0.5 + Math.random()) * 1.5,\n          y: pos.y + (0.5 + Math.random()) * 1.5,\n          z: pos.z + (-0.5 + Math.random()) * 1.5,\n          duration: 1,\n          ease: \"power4.out\",\n        })\n\n        gsap.to(mesh.scale, {\n          x: 0,\n          y: 0,\n          z: 0,\n          duration: 1,\n          ease: \"power4.out\",\n          onComplete: () => {\n            spawnCarrot()\n            isExplodingRef.current = false\n          },\n        })\n      }\n\n      for (const mesh of particles2Ref.current) {\n        mesh.position.set(pos.x, pos.y, pos.z)\n        mesh.scale.set(2, 2, 2)\n\n        gsap.to(mesh.position, {\n          x: pos.x + (-0.5 + Math.random()) * 1.5,\n          y: pos.y + (0.5 + Math.random()) * 1.5,\n          z: pos.z + (-0.5 + Math.random()) * 1.5,\n          duration: 1,\n          ease: \"power4.out\",\n        })\n\n        gsap.to(mesh.scale, {\n          x: 0,\n          y: 0,\n          z: 0,\n          duration: 1,\n          ease: \"power4.out\",\n        })\n      }\n    },\n    [spawnCarrot],\n  )\n\n  const testCollision = useCallback(() => {\n    if (isExplodingRef.current || !rabbitRef.current || !carrotRef.current) return\n\n    const distVec = rabbitRef.current.position.clone()\n    distVec.sub(carrotRef.current.position)\n\n    if (distVec.length() <= 1 && carrotRef.current.visible) {\n      carrotRef.current.visible = false\n      hideCarrotMarker()\n      explode(carrotRef.current.position.clone())\n      onCarrotCollected()\n    }\n  }, [explode, hideCarrotMarker, onCarrotCollected])\n\n  const jump = useCallback(() => {\n    if (\n      !rabbitRef.current ||\n      !rabbitBodyRef.current ||\n      !earLeftRef.current ||\n      !earRightRef.current\n    ) {\n      return\n    }\n\n    setIsJumping(true)\n    const turns = Math.floor(heroSpeedRef.current.length() * 5) + 1\n    const jumpDuration = 0.5 + turns * 0.2\n    const targetRot = heroAngularSpeedRef.current > 0 ? Math.PI * 2 * turns : -Math.PI * 2 * turns\n\n    gsap.to(rabbitBodyRef.current.rotation, {\n      duration: jumpDuration,\n      ease: \"linear.none\",\n      y: targetRot,\n      onComplete: () => {\n        if (rabbitBodyRef.current) rabbitBodyRef.current.rotation.y = 0\n      },\n    })\n\n    gsap.to([earLeftRef.current.rotation, earRightRef.current.rotation], {\n      duration: jumpDuration * 0.8,\n      ease: \"power4.out\",\n      x: Math.PI / 4,\n    })\n\n    gsap.to([earLeftRef.current.rotation, earRightRef.current.rotation], {\n      duration: jumpDuration * 0.2,\n      delay: jumpDuration * 0.8,\n      ease: \"power4.in\",\n      x: 0,\n    })\n\n    gsap.to(jumpParamsRef.current, {\n      duration: jumpDuration * 0.5,\n      ease: \"power2.out\",\n      jumpProgress: 0.5,\n      onUpdate: () => {\n        if (!rabbitRef.current) return\n        const sin = Math.sin(jumpParamsRef.current.jumpProgress * Math.PI)\n        rabbitRef.current.position.y = Math.pow(sin, 4) * turns\n      },\n    })\n\n    gsap.to(jumpParamsRef.current, {\n      duration: jumpDuration * 0.5,\n      ease: \"power2.in\",\n      delay: jumpDuration * 0.5,\n      jumpProgress: 1,\n      onUpdate: () => {\n        if (!rabbitRef.current) return\n        const sin = Math.sin(jumpParamsRef.current.jumpProgress * Math.PI)\n        rabbitRef.current.position.y = Math.pow(sin, 1) * turns\n      },\n      onComplete: () => {\n        if (!rabbitRef.current) return\n        rabbitRef.current.position.y = 0\n        jumpParamsRef.current.jumpProgress = 0\n        setIsJumping(false)\n      },\n    })\n  }, [])\n\n  useBunnyPointerInput({\n    mouseRef,\n    rabbitRef,\n    isJumping,\n    onJump: jump,\n  })\n\n  useBunnyRuntimeLoop({\n    modelLoaded,\n    isMobile,\n    isJumping,\n    camera,\n    timeRef,\n    outlineMatRef,\n    rabbitRef,\n    earLeftRef,\n    earRightRef,\n    carrotRef,\n    floorRef,\n    lineRef,\n    floorSimMatRef,\n    bufferSimRef,\n    floorSizeRef,\n    mouseRef,\n    raycasterRef,\n    heroSpeedRef,\n    heroOldRotRef,\n    heroAngularSpeedRef,\n    heroOldUVPosRef,\n    heroNewUVPosRef,\n    targetHeroUVPosRef,\n    targetHeroAbsPosRef,\n    onCollisionCheck: testCollision,\n  })\n\n  return null\n}\n\nexport default BunnyScene\n","import { useCallback, useEffect, useRef, useState } from \"react\"\n\nconst CARROT_COUNT_STORAGE_KEY = \"bunny-carrot-count\"\n\nconst parseStoredCarrotCount = (value: string | null) => {\n  if (value === null) return 0\n  const parsed = parseInt(value, 10)\n  if (Number.isNaN(parsed) || parsed < 0) return 0\n  return parsed\n}\n\nconst useCarrotStorage = () => {\n  const [carrotCount, setCarrotCount] = useState(() => {\n    if (typeof window === \"undefined\") return 0\n    return parseStoredCarrotCount(window.sessionStorage.getItem(CARROT_COUNT_STORAGE_KEY))\n  })\n  const skipNextWriteRef = useRef(false)\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return\n\n    const handleStorage = (event: StorageEvent) => {\n      if (event.key !== CARROT_COUNT_STORAGE_KEY) return\n      const next = parseStoredCarrotCount(event.newValue)\n\n      setCarrotCount((prev) => {\n        if (prev === next) return prev\n        skipNextWriteRef.current = true\n        return next\n      })\n    }\n\n    window.addEventListener(\"storage\", handleStorage)\n    return () => window.removeEventListener(\"storage\", handleStorage)\n  }, [])\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return\n\n    if (skipNextWriteRef.current) {\n      skipNextWriteRef.current = false\n      return\n    }\n\n    window.sessionStorage.setItem(CARROT_COUNT_STORAGE_KEY, carrotCount.toString())\n  }, [carrotCount])\n\n  const incrementCarrotCount = useCallback(() => {\n    setCarrotCount((prev) => prev + 1)\n  }, [])\n\n  return {\n    carrotCount,\n    incrementCarrotCount,\n  }\n}\n\nexport default useCarrotStorage\n","import type React from \"react\"\nimport { useEffect, useMemo, useRef, useState } from \"react\"\nimport { createPortal } from \"react-dom\"\nimport { Canvas } from \"@react-three/fiber\"\nimport \"./BunnyModal.css\"\nimport { BUNNY_MODAL_THEME_TOKENS, type ThemeType } from \"../../theme/tokens\"\nimport useIsMobile from \"../../hooks/useIsMobile\"\nimport BunnyScene, { type BunnySceneColors } from \"./BunnyScene\"\nimport useCarrotStorage from \"./useCarrotStorage\"\n\ninterface BunnyModalProps {\n  onClose: () => void\n  theme: ThemeType\n}\n\nconst MODAL_ROOT_ID = \"bunny-modal-root\"\n\nconst BunnyModal: React.FC<BunnyModalProps> = ({ onClose, theme }) => {\n  const portalRef = useRef<HTMLDivElement | null>(null)\n  const [mounted, setMounted] = useState(false)\n  const isMobile = useIsMobile(768)\n  const { carrotCount, incrementCarrotCount } = useCarrotStorage()\n\n  useEffect(() => {\n    if (typeof document === \"undefined\") return\n\n    let host = document.getElementById(MODAL_ROOT_ID)\n    if (!host) {\n      host = document.createElement(\"div\")\n      host.id = MODAL_ROOT_ID\n      document.body.appendChild(host)\n    }\n\n    const container = document.createElement(\"div\")\n    host.appendChild(container)\n    portalRef.current = container\n    setMounted(true)\n\n    return () => {\n      if (portalRef.current && host?.contains(portalRef.current)) {\n        host.removeChild(portalRef.current)\n      }\n      if (host && host.childNodes.length === 0) {\n        host.remove()\n      }\n      portalRef.current = null\n    }\n  }, [])\n\n  const palette = BUNNY_MODAL_THEME_TOKENS[theme]\n  const bunnyCanvasDpr: [number, number] = isMobile ? [1, 1.1] : [1, 1.4]\n  const sceneColors = useMemo<BunnySceneColors>(\n    () => ({\n      floor: palette[\"--game-floor\"],\n      fog: palette[\"--game-fog\"],\n      bunnyPrimary: palette[\"--bunny-primary\"],\n      bunnySecondary: palette[\"--bunny-secondary\"],\n      carrotBody: palette[\"--carrot-body\"],\n      carrotLeaf: palette[\"--carrot-leaf\"],\n      outline: palette[\"--game-outline\"],\n    }),\n    [palette],\n  )\n\n  if (!mounted || !portalRef.current) {\n    return null\n  }\n\n  return createPortal(\n    <div\n      className=\"bunny-modal-backdrop\"\n      style={{\n        [\"--bunny-modal-border\" as string]: palette[\"--game-border\"],\n        [\"--bunny-modal-shadow\" as string]: palette[\"--game-shadow\"],\n        [\"--bunny-modal-radius\" as string]: isMobile ? \"18px\" : \"26px\",\n        [\"--bunny-modal-text\" as string]: palette[\"--color-text\"],\n        [\"--bunny-modal-accent\" as string]: palette[\"--color-accent-primary\"],\n        [\"--bunny-modal-button-bg\" as string]: palette[\"--button-bg-light\"],\n        [\"--bunny-modal-counter-top\" as string]: isMobile ? \"16px\" : \"26px\",\n        [\"--bunny-modal-counter-left\" as string]: isMobile ? \"16px\" : \"30px\",\n        [\"--bunny-modal-counter-size\" as string]: isMobile ? \"0.65rem\" : \"0.8rem\",\n      }}\n      onClick={onClose}\n    >\n      <div className=\"bunny-modal-panel\" onClick={(e) => e.stopPropagation()}>\n        <Canvas\n          className=\"bunny-modal-canvas\"\n          shadows={!isMobile}\n          gl={{\n            antialias: !isMobile,\n            preserveDrawingBuffer: false,\n            alpha: false,\n            powerPreference: \"high-performance\",\n          }}\n          dpr={bunnyCanvasDpr}\n        >\n          <BunnyScene\n            colors={sceneColors}\n            onCarrotCollected={incrementCarrotCount}\n            isMobile={isMobile}\n          />\n        </Canvas>\n\n        <div className=\"bunny-modal-counter\">CARROTS  {carrotCount}</div>\n\n        <div className=\"bunny-modal-hint\">- Press to jump -</div>\n\n        <div className=\"bunny-modal-footer\">\n          <button type=\"button\" className=\"bunny-modal-text-button\" onClick={onClose}>\n            close\n          </button>\n        </div>\n\n        <button type=\"button\" onClick={onClose} className=\"bunny-modal-close-button\">\n          \n        </button>\n      </div>\n    </div>,\n    portalRef.current,\n  )\n}\n\nexport default BunnyModal\n","let bunnyAssetsPrefetched = false\n\nexport const preloadBunnyAssets = () => {\n  if (bunnyAssetsPrefetched || typeof window === \"undefined\") return\n  bunnyAssetsPrefetched = true\n\n  // Warm the model request so opening the modal does not pay the network cost.\n  void fetch(\"/models/rabbit.glb\").catch(() => {\n    // Allow another attempt if the first prefetch fails.\n    bunnyAssetsPrefetched = false\n  })\n}\n"],"names":["BufferSim","constructor","renderer","width","height","shader","orthoScene","fbos","current","output","orthoCamera","orthoQuad","this","THREE","fbo","wrapS","wrapT","minFilter","magFilter","format","type","stencilBuffer","depthBuffer","texture","generateMipmaps","clone","add","render","uniforms","inputTexture","value","setRenderTarget","dispose","geometry","forEach","getShortestAngle","v","a","Math","PI","constrain","vMin","vMax","min","max","createBunnySceneScaffold","_ref3","gl","isMobile","colors","floorSizeRef","lineRef","floorRef","carrotMarkerRef","carrotMarkerDotRef","bufferSimRef","floorSimMatRef","particlesRef","particles2Ref","primMatRef","bonusMatRef","addToScene","reflectorTextureSize","floorSimMat","lineMaterial","color","linewidth","scale","dashSize","gapSize","lineGeometry","setFromPoints","line","particleGeom","particles1","particles2","i","mesh","set","push","directionalLight","position","castShadow","shadow","mapSize","camera","near","far","left","right","bottom","top","radius","blurSamples","floor","Reflector","textureWidth","textureHeight","rotation","x","receiveShadow","material","tScratches","simTextureSize","time","blade1PosOld","blade1PosNew","strength","vertexShader","fragmentShader","carrotMarker","carrotBody","transparent","opacity","side","y","visible","carrotMarkerDot","carrotLeaf","CARROT_MARKER_Y_OFFSET","useBunnySceneSetup","_ref","scene","setModelLoaded","rabbitRef","rabbitBodyRef","earLeftRef","earRightRef","carrotRef","secMatRef","leafMatRef","outlineMatRef","useEffect","fog","getHex","lookAt","createdObjects","disposedRef","object","_ref2","materialRefs","GLTFLoader","load","gltf","model","rabbit","getObjectByName","rabbitBody","earRight","earLeft","tail","footLeft","footRight","eyeLeft","eyeRight","carrot","carrotLeaf2","applyRabbitMaterialsAndOutlines","parts","z","addOutline","obj","outline","children","traverse","isMesh","loadRabbitModelIntoScene","_floorRef$current","_floorRef$current$dis","_bufferSimRef$current","call","parent","remove","objects","geometries","Set","child","isLine","disposeObjectGeometries","onCarrotCollected","useThree","modelLoaded","useState","isJumping","setIsJumping","useRef","heroSpeedRef","heroOldRotRef","heroAngularSpeedRef","heroOldUVPosRef","heroNewUVPosRef","targetHeroUVPosRef","targetHeroAbsPosRef","jumpParamsRef","jumpProgress","isExplodingRef","mouseRef","raycasterRef","timeRef","bunnyPrimary","bunnySecondary","size","_mat$uniforms","mat","jumpParams","primMat","secMat","bonusMat","leafMat","outlineMat","gsap","killTweensOf","hideCarrotMarker","useCallback","spawnCarrot","spawnRange","px","random","py","h","spawnX","spawnZ","to","duration","ease","explode","pos","onComplete","testCollision","distVec","sub","length","jump","turns","jumpDuration","targetRot","delay","onUpdate","sin","pow","onJump","handleMouseMove","event","clientX","window","innerWidth","clientY","innerHeight","handleTouchMove","touches","preventDefault","handlePress","addEventListener","passive","removeEventListener","useBunnyPointerInput","onCollisionCheck","useFrame","_","delta","dt","setFromCamera","intersects","intersectObject","uv","clampRange","constrainUVPosX","constrainUVPosY","dx","dy","angle","atan2","heroDistance","sqrt","ax","ay","linePositions","attributes","array","needsUpdate","computeLineDistances","scratchUniform","copy","useBunnyRuntimeLoop","CARROT_COUNT_STORAGE_KEY","parseStoredCarrotCount","parsed","parseInt","Number","isNaN","useCarrotStorage","carrotCount","setCarrotCount","sessionStorage","getItem","skipNextWriteRef","handleStorage","key","next","newValue","prev","setItem","toString","incrementCarrotCount","MODAL_ROOT_ID","onClose","theme","portalRef","mounted","setMounted","useIsMobile","document","host","getElementById","createElement","id","body","appendChild","container","_host","contains","removeChild","childNodes","palette","BUNNY_MODAL_THEME_TOKENS","bunnyCanvasDpr","sceneColors","useMemo","createPortal","_jsx","className","style","onClick","_jsxs","e","stopPropagation","Canvas","shadows","antialias","preserveDrawingBuffer","alpha","powerPreference","dpr","BunnyScene","bunnyAssetsPrefetched","preloadBunnyAssets","fetch","catch"],"sourceRoot":""}