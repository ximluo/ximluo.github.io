"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[537],{537:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var n=r(43),o=r(950),i=r(968),a=r(37),s=r(435),c=r(718),u=r(865),l=r(270),d=r(340),h=r(227),f=r(579);const m="bunny-modal-root",p=.01,w="bunny-carrot-count",y=e=>{if(null===e)return 0;const t=parseInt(e,10);return Number.isNaN(t)||t<0?0:t};class v{constructor(e,t,r,n){this.renderer=void 0,this.shader=void 0,this.orthoScene=void 0,this.fbos=void 0,this.current=void 0,this.output=void 0,this.orthoCamera=void 0,this.orthoQuad=void 0,this.renderer=e,this.shader=n,this.orthoScene=new s.Z58;const o=new s.nWS(t,r,{wrapS:s.ghU,wrapT:s.ghU,minFilter:s.k6q,magFilter:s.k6q,format:s.GWd,type:s.RQf,stencilBuffer:!1,depthBuffer:!1});o.texture.generateMipmaps=!1,this.fbos=[o,o.clone()],this.current=0,this.output=this.fbos[0],this.orthoCamera=new s.qUd(t/-2,t/2,r/2,r/-2,1e-5,1e3),this.orthoQuad=new s.eaF(new s.bdM(t,r),this.shader),this.orthoScene.add(this.orthoQuad)}render(){this.shader.uniforms.inputTexture.value=this.fbos[this.current].texture,this.current=1-this.current,this.output=this.fbos[this.current],this.renderer.setRenderTarget(this.output),this.renderer.render(this.orthoScene,this.orthoCamera),this.renderer.setRenderTarget(null)}}const g=e=>{let{colors:t,onCarrotCollected:r,isMobile:o}=e;const{scene:a,gl:d,camera:h}=(0,i.C)(),[f,m]=(0,n.useState)(!1),[w,y]=(0,n.useState)(!1),g=(0,n.useRef)(null),b=(0,n.useRef)(null),x=(0,n.useRef)(null),P=(0,n.useRef)(null),R=(0,n.useRef)(null),S=(0,n.useRef)(null),M=(0,n.useRef)(null),j=(0,n.useRef)(null),z=(0,n.useRef)(null),k=(0,n.useRef)(null),C=(0,n.useRef)(null),I=(0,n.useRef)([]),B=(0,n.useRef)([]),N=(0,n.useRef)(new s.I9Y(0,0)),O=(0,n.useRef)(0),L=(0,n.useRef)(0),E=(0,n.useRef)(new s.I9Y(.5,.5)),A=(0,n.useRef)(new s.I9Y(.5,.5)),F=(0,n.useRef)(new s.I9Y(.5,.5)),Q=(0,n.useRef)(new s.I9Y(0,0)),U=(0,n.useRef)({jumpProgress:0}),T=(0,n.useRef)(!1),D=(0,n.useRef)(new s.I9Y),Y=(0,n.useRef)(new s.tBo),V=(0,n.useRef)(30),q=(0,n.useRef)(0),H=(0,n.useRef)(new s.Df({color:new s.Q1f(t.bunnyPrimary)})),$=(0,n.useRef)(new s.Df({color:new s.Q1f(t.bunnySecondary)})),G=(0,n.useRef)(new s.Df({color:new s.Q1f(t.carrotBody)})),W=(0,n.useRef)(new s.Df({color:new s.Q1f(t.carrotLeaf)})),K=(0,n.useRef)(new s.BKk({uniforms:{color:{value:new s.Q1f(0)},size:{value:.02},time:{value:0}},vertexShader:"\n      uniform float size;\n      uniform float time;\n\n      void main() {\n        vec3 transformed = position + normal * size * (1.0 + abs(sin(position.y * time * 0.02) * 2.0));\n        vec4 modelViewPosition = modelViewMatrix * vec4(transformed, 1.0);\n        gl_Position = projectionMatrix * modelViewPosition; \n      }\n    ",fragmentShader:"\n      uniform vec3 color;\n      void main() {\n        gl_FragColor = vec4(color, 1.0);\n      }\n    ",side:s.hsX}));(0,n.useEffect)((()=>{if(H.current.color.set(t.bunnyPrimary),$.current.color.set(t.bunnySecondary),G.current.color.set(t.carrotBody),W.current.color.set(t.carrotLeaf),K.current.uniforms.color.value=new s.Q1f(t.outline),a.fog=new s.jUj(new s.Q1f(t.fog).getHex(),13,20),j.current){var e;const r=j.current.material;null!==r&&void 0!==r&&r.color?r.color.set(t.floor):null!==r&&void 0!==r&&null!==(e=r.uniforms)&&void 0!==e&&e.color&&r.uniforms.color.value.set(new s.Q1f(t.floor))}if(S.current){S.current.material.color.set(t.carrotBody)}if(M.current){M.current.material.color.set(t.carrotLeaf)}}),[t,a]),(0,n.useEffect)((()=>{a.fog=new s.jUj(new s.Q1f(t.fog).getHex(),13,20),h.position.set(0,4,8),h.lookAt(0,0,0);const e=new s.BKk({uniforms:{inputTexture:{value:null},time:{value:0},blade1PosOld:{value:new s.I9Y(.5,.5)},blade1PosNew:{value:new s.I9Y(.5,.5)},strength:{value:0}},vertexShader:"\n        precision highp float;\n        uniform float time;\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n          gl_Position = projectionMatrix * modelViewPosition; \n        }\n      ",fragmentShader:"\n        precision highp float;\n        uniform sampler2D inputTexture;\n        uniform vec2 blade1PosOld;\n        uniform vec2 blade1PosNew;\n        uniform float strength;\n        uniform float time;\n        varying vec2 vUv;\n\n        float lineSegment(vec2 p, vec2 a, vec2 b, float thickness) {\n            vec2 pa = p - a;\n            vec2 ba = b - a;\n            float h = clamp(dot(pa,ba)/dot(ba,ba), 0.0, 1.0);\n            float idk = length(pa - ba*h);\n            return smoothstep(thickness, 0.2 * thickness, idk);\n        }\n\n        void main(void) {\n          vec4 prevTexture = texture2D(inputTexture, vUv);\n          vec3 col = prevTexture.rgb * 0.999;\n          if (strength > 0.0) {\n              float space = 0.001;\n              float crease = 0.001;\n              float thickness = 0.001 + strength * 0.001;\n              float leftRed = lineSegment(vUv + space, blade1PosOld, blade1PosNew, thickness);\n              float leftGreen = lineSegment(vUv + space + crease, blade1PosOld, blade1PosNew, thickness);\n              float rightRed = lineSegment(vUv - space - crease, blade1PosOld, blade1PosNew, thickness);\n              float rightGreen = lineSegment(vUv - space, blade1PosOld, blade1PosNew, thickness);\n              col.r += (leftRed + rightRed) * strength * 3.0;\n              col.g += (leftGreen + rightGreen) * strength * 3.0;\n              col.r = clamp(col.r, 0.0, 1.0);\n              col.g = clamp(col.g, 0.0, 1.0);\n          }\n          gl_FragColor = vec4(col, 1.0);\n        }\n      "});C.current=e,k.current=new v(d,1024,1024,e);const r=new s.Fvt({color:8122111,linewidth:1,scale:1,dashSize:.2,gapSize:.1}),n=[];n.push(new s.Pq0(0,.2,0)),n.push(new s.Pq0(3,.2,3));const o=(new s.LoY).setFromPoints(n),i=new s.N1A(o,r);a.add(i),z.current=i;const l=new s.iNn(.2,.2,.2,1,1,1),f=[],y=[];for(let t=0;t<20;t++){const e=new s.eaF(l,G.current);f.push(e),e.scale.set(0,0,0),a.add(e)}for(let t=0;t<5;t++){const e=new s.eaF(l,H.current);y.push(e),e.scale.set(0,0,0),a.add(e)}I.current=f,B.current=y;const N=new s.$p8(16777215);a.add(N);const O=new s.ZyN(16777215,1);O.position.set(1,5,1),O.castShadow=!0,O.shadow.mapSize.width=512,O.shadow.mapSize.height=512,O.shadow.camera.near=.5,O.shadow.camera.far=12,O.shadow.camera.left=-12,O.shadow.camera.right=12,O.shadow.camera.bottom=-12,O.shadow.camera.top=12,O.shadow.radius=3,O.shadow.blurSamples=4,a.add(O);(new c.B).load("/models/rabbit.glb",(e=>{const t=e.scene,r=t.getObjectByName("Rabbit"),n=t.getObjectByName("body"),o=t.getObjectByName("earRight"),i=t.getObjectByName("earLeft"),s=t.getObjectByName("tail"),c=t.getObjectByName("footLeft"),u=t.getObjectByName("footRight"),l=t.getObjectByName("eyeLeft"),d=t.getObjectByName("eyeRight"),h=t.getObjectByName("carrot"),f=t.getObjectByName("carrotLeaf"),p=t.getObjectByName("carrotLeaf2");if(r&&n&&o&&i&&s&&c&&u&&l&&d&&h&&f&&p){h.rotation.z=.2,h.rotation.x=.2,n.material=H.current,o.material=H.current,i.material=H.current,s.material=H.current,c.material=$.current,u.material=$.current,l.material=$.current,d.material=$.current,h.material=G.current,f.material=W.current,p.material=W.current;const e=e=>{const t=e.clone();t.children=[],t.position.set(0,0,0),t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,t.scale.set(1,1,1),t.material=K.current,e.add(t)};e(n),e(o),e(i),e(s),e(h),r.traverse((e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),h.traverse((e=>{e.isMesh&&(e.castShadow=!0)})),a.add(r),a.add(h),g.current=r,b.current=n,x.current=i,P.current=o,R.current=h,m(!0)}}));const L=new u.J(new s.bdM(V.current,V.current),{color:new s.Q1f(t.floor),textureWidth:1024,textureHeight:1024});L.rotation.x=-Math.PI/2,L.receiveShadow=!0,a.add(L),j.current=L;const E=new s.eaF(new s.rKP(.25,.35,32),new s.V9B({color:new s.Q1f(t.carrotBody),transparent:!0,opacity:.65,side:s.$EB}));E.rotation.x=-Math.PI/2,E.position.y=p,E.visible=!1,a.add(E),S.current=E;const A=new s.eaF(new s.tcD(.07,24),new s.V9B({color:new s.Q1f(t.carrotLeaf),side:s.$EB}));A.rotation.x=-Math.PI/2,A.position.y=.015,A.visible=!1,a.add(A),M.current=A;const F=e=>{D.current.x=e.clientX/window.innerWidth*2-1,D.current.y=-e.clientY/window.innerHeight*2+1},Q=e=>{1===e.touches.length&&(e.preventDefault(),D.current.x=e.touches[0].clientX/window.innerWidth*2-1,D.current.y=-e.touches[0].clientY/window.innerHeight*2+1)},U=()=>{g.current&&!w&&J()};return window.addEventListener("mousemove",F),window.addEventListener("touchmove",Q,{passive:!1}),window.addEventListener("mousedown",U),window.addEventListener("touchstart",U),()=>{window.removeEventListener("mousemove",F),window.removeEventListener("touchmove",Q),window.removeEventListener("mousedown",U),window.removeEventListener("touchstart",U)}}),[a,h,d,t.floor,t.fog]);const _=e=>{let t=e%(2*Math.PI);return t<-Math.PI?t+=2*Math.PI:t>Math.PI&&(t-=2*Math.PI),t},X=(e,t,r)=>Math.min(r,Math.max(t,e)),Z=(0,n.useCallback)((()=>{S.current&&(S.current.visible=!1),M.current&&(M.current.visible=!1)}),[]),J=()=>{if(!g.current||!b.current||!x.current||!P.current)return;y(!0);const e=Math.floor(5*N.current.length())+1,t=.5+.2*e,r=L.current>0?2*Math.PI*e:2*-Math.PI*e;l.Ay.to(b.current.rotation,{duration:t,ease:"linear.none",y:r,onComplete:()=>{b.current&&(b.current.rotation.y=0)}}),l.Ay.to([x.current.rotation,P.current.rotation],{duration:.8*t,ease:"power4.out",x:Math.PI/4}),l.Ay.to([x.current.rotation,P.current.rotation],{duration:.2*t,delay:.8*t,ease:"power4.in",x:0}),l.Ay.to(U.current,{duration:.5*t,ease:"power2.out",jumpProgress:.5,onUpdate:()=>{if(!g.current)return;const t=Math.sin(U.current.jumpProgress*Math.PI);g.current.position.y=Math.pow(t,4)*e}}),l.Ay.to(U.current,{duration:.5*t,ease:"power2.in",delay:.5*t,jumpProgress:1,onUpdate:()=>{if(!g.current)return;const t=Math.sin(U.current.jumpProgress*Math.PI);g.current.position.y=Math.pow(t,1)*e},onComplete:()=>{g.current&&(g.current.position.y=0,U.current.jumpProgress=0,y(!1))}})},ee=e=>{T.current=!0;const t=I.current.length,r=B.current.length;for(let n=0;n<t;n++){const t=I.current[n];t.position.x=e.x,t.position.y=e.y,t.position.z=e.z,t.scale.set(2,2,2),l.Ay.to(t.position,{x:e.x+1.5*(-.5+Math.random()),y:e.y+1.5*(.5+Math.random()),z:e.z+1.5*(-.5+Math.random()),duration:1,ease:"power4.out"}),l.Ay.to(t.scale,{x:0,y:0,z:0,duration:1,ease:"power4.out",onComplete:()=>{te(),T.current=!1}})}for(let n=0;n<r;n++){const t=B.current[n];t.position.x=e.x,t.position.y=e.y,t.position.z=e.z,t.scale.set(2,2,2),l.Ay.to(t.position,{x:e.x+1.5*(-.5+Math.random()),y:e.y+1.5*(.5+Math.random()),z:e.z+1.5*(-.5+Math.random()),duration:1,ease:"power4.out"}),l.Ay.to(t.scale,{x:0,y:0,z:0,duration:1,ease:"power4.out"})}},te=()=>{if(!R.current)return;Z();const e=o?.24:.3,t=(Math.random()-.5)*e,r=(Math.random()-.5)*e,n=.2+1*Math.random(),i=t*V.current,a=r*V.current;R.current.position.x=i,R.current.position.z=a,R.current.position.y=-1,R.current.scale.set(0,0,0),R.current.visible=!0;n>.85&&S.current&&M.current&&(S.current.visible=!0,M.current.visible=!0,S.current.position.set(i,p,a),M.current.position.set(i,.015,a),S.current.scale.set(.4,.4,.4),M.current.scale.set(0,0,0),l.Ay.to(S.current.scale,{duration:.8,ease:"elastic.out",x:1,y:1,z:1}),l.Ay.to(M.current.scale,{duration:.6,ease:"back.out(1.7)",x:1,y:1,z:1})),l.Ay.to(R.current.scale,{duration:1.5,ease:"elastic.out",x:1,y:1,z:1}),l.Ay.to(R.current.position,{duration:1.5,ease:"elastic.out",y:n})};return(0,i.D)(((e,t)=>{if(!f)return;const n=Math.min(t,.3);if(q.current+=n,K.current&&(K.current.uniforms.time.value=q.current),g.current&&z.current&&j.current&&C.current&&k.current){(()=>{if(!j.current)return;Y.current.setFromCamera(D.current,h);const e=Y.current.intersectObject(j.current);e.length>0&&e[0].uv&&(F.current.x=e[0].uv.x,F.current.y=e[0].uv.y)})();const e=o?.22:.3,t=X(F.current.x-.5,-e,e),i=X(F.current.y-.5,-e,e);Q.current.x=t*V.current,Q.current.y=-i*V.current;const a=Q.current.x-g.current.position.x,c=Q.current.y-g.current.position.z,u=Math.atan2(c,a),l=Math.sqrt(a*a+c*c),d=a*n*.3,f=c*n*.3;N.current.x+=d,N.current.y+=f,N.current.x*=Math.pow(n,.005),N.current.y*=Math.pow(n,.005),g.current.position.x+=N.current.x,g.current.position.z+=N.current.y;const m=-u+Math.PI/2;l>.3&&(g.current.rotation.y+=3*_(m-g.current.rotation.y)*n),L.current=_(g.current.rotation.y-O.current),O.current=g.current.rotation.y,!w&&x.current&&P.current&&(x.current.rotation.x=P.current.rotation.x=2*-N.current.length());const p=z.current.geometry.attributes.position.array;p[0]=Q.current.x,p[2]=Q.current.y,p[3]=g.current.position.x,p[4]=g.current.position.y,p[5]=g.current.position.z,z.current.geometry.attributes.position.needsUpdate=!0,z.current.computeLineDistances(),A.current.x=.5+g.current.position.x/V.current,A.current.y=.5-g.current.position.z/V.current,C.current.uniforms.time.value+=n,C.current.uniforms.blade1PosNew.value=A.current,C.current.uniforms.blade1PosOld.value=E.current,C.current.uniforms.strength.value=w?0:1/(1+10*N.current.length()),k.current.render(),j.current.material instanceof s.BKk&&(j.current.material.uniforms.tScratches={value:k.current.output.texture}),E.current.copy(A.current),R.current&&(R.current.rotation.y+=n),(()=>{if(T.current||!g.current||!R.current)return;const e=g.current.position.clone();e.sub(R.current.position),e.length()<=1&&R.current.visible&&(R.current.visible=!1,Z(),ee(R.current.position.clone()),r())})()}})),null},b=e=>{let{onClose:t,theme:r}=e;const i=(0,n.useRef)(null),[s,c]=(0,n.useState)(!1),[u,l]=(0,n.useState)((()=>"undefined"===typeof window?0:y(window.sessionStorage.getItem(w)))),p=(0,h.A)(768),v=(0,n.useRef)(!1);(0,n.useEffect)((()=>{if("undefined"===typeof document)return;let e=document.getElementById(m);e||(e=document.createElement("div"),e.id=m,document.body.appendChild(e));const t=document.createElement("div");return e.appendChild(t),i.current=t,c(!0),()=>{var t;i.current&&null!==(t=e)&&void 0!==t&&t.contains(i.current)&&e.removeChild(i.current),e&&0===e.childNodes.length&&e.remove(),i.current=null}}),[]),(0,n.useEffect)((()=>{if("undefined"===typeof window)return;const e=e=>{if(e.key!==w)return;const t=y(e.newValue);l((e=>e===t?e:(v.current=!0,t)))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),[]),(0,n.useEffect)((()=>{"undefined"!==typeof window&&(v.current?v.current=!1:window.sessionStorage.setItem(w,u.toString()))}),[u]);const b=d.Sj[r],x=(0,n.useMemo)((()=>({floor:b["--game-floor"],fog:b["--game-fog"],bunnyPrimary:b["--bunny-primary"],bunnySecondary:b["--bunny-secondary"],carrotBody:b["--carrot-body"],carrotLeaf:b["--carrot-leaf"],outline:b["--game-outline"]})),[b]),P=(0,n.useCallback)((()=>{l((e=>e+1))}),[]);return s&&i.current?(0,o.createPortal)((0,f.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:1e3},onClick:t,children:(0,f.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",border:`8px solid ${b["--game-border"]}`,borderRadius:p?"18px":"26px",boxSizing:"border-box",boxShadow:`0 0 35px ${b["--game-shadow"]}`},onClick:e=>e.stopPropagation(),children:[(0,f.jsx)(a.Hl,{shadows:!0,gl:{antialias:!0,preserveDrawingBuffer:!0,alpha:!1},dpr:"undefined"!==typeof window?window.devicePixelRatio:1,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",outline:"none",cursor:"grabbing"},children:(0,f.jsx)(g,{colors:x,onCarrotCollected:P,isMobile:p})}),(0,f.jsxs)("div",{style:{position:"absolute",top:p?"16px":"26px",left:p?"16px":"30px",padding:"8px 16px",borderRadius:999,fontFamily:"monospace",fontSize:p?"0.65rem":"0.8rem",letterSpacing:"0.1em",color:b["--color-text"],backgroundColor:b["--button-bg-light"],border:`1px solid ${b["--game-border"]}`,zIndex:1e3},children:["CARROTS \xb7 ",u]}),(0,f.jsx)("div",{style:{position:"absolute",width:"100%",bottom:"60px",fontFamily:"'Open Sans', sans-serif",color:b["--color-accent-primary"],fontSize:"0.75em",textTransform:"uppercase",textAlign:"center",letterSpacing:"0.3em"},children:"- Press to jump -"}),(0,f.jsx)("div",{style:{position:"absolute",width:"100%",bottom:"20px",fontFamily:"'Open Sans', sans-serif",color:b["--color-text"],fontSize:"0.7em",textTransform:"uppercase",textAlign:"center"},children:(0,f.jsx)("button",{type:"button",style:{color:b["--color-accent-primary"],background:"none",border:"none",padding:0,cursor:"pointer",fontFamily:"inherit",fontSize:"inherit",textTransform:"inherit"},onClick:t,children:"close"})}),(0,f.jsx)("button",{onClick:t,style:{position:"absolute",top:"15px",right:"15px",width:"36px",height:"36px",borderRadius:"50%",backgroundColor:b["--button-bg-light"],color:b["--color-text"],border:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",cursor:"pointer",zIndex:1001},children:"\xd7"})]})}),i.current):null}}}]);
//# sourceMappingURL=537.b39db5f0.chunk.js.map