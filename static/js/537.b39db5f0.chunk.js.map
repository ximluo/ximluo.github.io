{"version":3,"file":"static/js/537.b39db5f0.chunk.js","mappings":"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","sources":["components/BunnyModal.tsx"],"sourcesContent":["\"use client\"\n\nimport type React from \"react\"\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\"\nimport { createPortal } from \"react-dom\"\nimport { Canvas, useFrame, useThree } from \"@react-three/fiber\"\nimport * as THREE from \"three\"\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader.js\"\nimport { Reflector } from \"three/examples/jsm/objects/Reflector.js\"\nimport gsap from \"gsap\"\nimport { BUNNY_MODAL_THEME_TOKENS, type ThemeType } from \"../theme/tokens\"\nimport useIsMobile from \"../hooks/useIsMobile\"\n\ninterface BunnyModalProps {\n  onClose: () => void\n  theme: ThemeType\n}\n\ninterface BunnySceneColors {\n  floor: string\n  fog: string\n  bunnyPrimary: string\n  bunnySecondary: string\n  carrotBody: string\n  carrotLeaf: string\n  outline: string\n}\n\ninterface BunnySceneProps {\n  colors: BunnySceneColors\n  onCarrotCollected: () => void\n  isMobile: boolean\n}\n\nconst MODAL_ROOT_ID = \"bunny-modal-root\"\nconst HIGH_CARROT_HEIGHT_THRESHOLD = 0.85\nconst CARROT_MARKER_Y_OFFSET = 0.01\nconst CARROT_COUNT_STORAGE_KEY = \"bunny-carrot-count\"\n\nconst parseStoredCarrotCount = (value: string | null) => {\n  if (value === null) return 0\n  const parsed = parseInt(value, 10)\n  if (Number.isNaN(parsed) || parsed < 0) return 0\n  return parsed\n}\n\n// Custom shader materials\nconst createOutlineMaterial = () => {\n  return new THREE.ShaderMaterial({\n    uniforms: {\n      color: { value: new THREE.Color(0x000000) },\n      size: { value: 0.02 },\n      time: { value: 0.0 },\n    },\n    vertexShader: `\n      uniform float size;\n      uniform float time;\n\n      void main() {\n        vec3 transformed = position + normal * size * (1.0 + abs(sin(position.y * time * 0.02) * 2.0));\n        vec4 modelViewPosition = modelViewMatrix * vec4(transformed, 1.0);\n        gl_Position = projectionMatrix * modelViewPosition; \n      }\n    `,\n    fragmentShader: `\n      uniform vec3 color;\n      void main() {\n        gl_FragColor = vec4(color, 1.0);\n      }\n    `,\n    side: THREE.BackSide,\n  })\n}\n\n// Buffer simulation for floor effects\nclass BufferSim {\n  renderer: THREE.WebGLRenderer\n  shader: THREE.ShaderMaterial\n  orthoScene: THREE.Scene\n  fbos: THREE.WebGLRenderTarget[]\n  current: number\n  output: THREE.WebGLRenderTarget\n  orthoCamera: THREE.OrthographicCamera\n  orthoQuad: THREE.Mesh\n\n  constructor(renderer: THREE.WebGLRenderer, width: number, height: number, shader: THREE.ShaderMaterial) {\n    this.renderer = renderer\n    this.shader = shader\n    this.orthoScene = new THREE.Scene()\n\n    const fbo = new THREE.WebGLRenderTarget(width, height, {\n      wrapS: THREE.ClampToEdgeWrapping,\n      wrapT: THREE.ClampToEdgeWrapping,\n      minFilter: THREE.LinearFilter,\n      magFilter: THREE.LinearFilter,\n      format: THREE.RGBAFormat,\n      type: THREE.FloatType,\n      stencilBuffer: false,\n      depthBuffer: false,\n    })\n\n    fbo.texture.generateMipmaps = false\n\n    this.fbos = [fbo, fbo.clone()]\n    this.current = 0\n    this.output = this.fbos[0]\n    this.orthoCamera = new THREE.OrthographicCamera(width / -2, width / 2, height / 2, height / -2, 0.00001, 1000)\n    this.orthoQuad = new THREE.Mesh(new THREE.PlaneGeometry(width, height), this.shader)\n    this.orthoScene.add(this.orthoQuad)\n  }\n\n  render() {\n    this.shader.uniforms.inputTexture.value = this.fbos[this.current].texture\n    this.current = 1 - this.current\n    this.output = this.fbos[this.current]\n    this.renderer.setRenderTarget(this.output)\n    this.renderer.render(this.orthoScene, this.orthoCamera)\n    this.renderer.setRenderTarget(null)\n  }\n}\n\n// Main BunnyScene component\nconst BunnyScene: React.FC<BunnySceneProps> = ({ colors, onCarrotCollected, isMobile }) => {\n  const { scene, gl, camera } = useThree()\n  const [modelLoaded, setModelLoaded] = useState(false)\n  const [isJumping, setIsJumping] = useState(false)\n\n  // References\n  const rabbitRef = useRef<THREE.Group>(null)\n  const rabbitBodyRef = useRef<THREE.Object3D>(null)\n  const earLeftRef = useRef<THREE.Object3D>(null)\n  const earRightRef = useRef<THREE.Object3D>(null)\n  const carrotRef = useRef<THREE.Object3D>(null)\n  const carrotMarkerRef = useRef<THREE.Mesh | null>(null)\n  const carrotMarkerDotRef = useRef<THREE.Mesh | null>(null)\n  const floorRef = useRef<Reflector>(null)\n  const lineRef = useRef<THREE.Line>(null)\n  const bufferSimRef = useRef<BufferSim | null>(null)\n  const floorSimMatRef = useRef<THREE.ShaderMaterial | null>(null)\n  const particlesRef = useRef<THREE.Mesh[]>([])\n  const particles2Ref = useRef<THREE.Mesh[]>([])\n\n  // Game state\n  const heroSpeedRef = useRef(new THREE.Vector2(0, 0))\n  const heroOldRotRef = useRef(0)\n  const heroAngularSpeedRef = useRef(0)\n  const heroOldUVPosRef = useRef(new THREE.Vector2(0.5, 0.5))\n  const heroNewUVPosRef = useRef(new THREE.Vector2(0.5, 0.5))\n  const targetHeroUVPosRef = useRef(new THREE.Vector2(0.5, 0.5))\n  const targetHeroAbsPosRef = useRef(new THREE.Vector2(0, 0))\n  const jumpParamsRef = useRef({ jumpProgress: 0 })\n  const isExplodingRef = useRef(false)\n  const mouseRef = useRef(new THREE.Vector2())\n  const raycasterRef = useRef(new THREE.Raycaster())\n  const floorSizeRef = useRef(30)\n  const timeRef = useRef(0)\n\n  // Materials\n  const primMatRef = useRef<THREE.MeshToonMaterial>(new THREE.MeshToonMaterial({ color: new THREE.Color(colors.bunnyPrimary) }))\n  const secMatRef = useRef<THREE.MeshToonMaterial>(new THREE.MeshToonMaterial({ color: new THREE.Color(colors.bunnySecondary) }))\n  const bonusMatRef = useRef<THREE.MeshToonMaterial>(new THREE.MeshToonMaterial({ color: new THREE.Color(colors.carrotBody) }))\n  const leafMatRef = useRef<THREE.MeshToonMaterial>(new THREE.MeshToonMaterial({ color: new THREE.Color(colors.carrotLeaf) }))\n  const outlineMatRef = useRef<THREE.ShaderMaterial>(createOutlineMaterial())\n\n  // Setup scene\n  useEffect(() => {\n    primMatRef.current.color.set(colors.bunnyPrimary)\n    secMatRef.current.color.set(colors.bunnySecondary)\n    bonusMatRef.current.color.set(colors.carrotBody)\n    leafMatRef.current.color.set(colors.carrotLeaf)\n    outlineMatRef.current.uniforms.color.value = new THREE.Color(colors.outline)\n    scene.fog = new THREE.Fog(new THREE.Color(colors.fog).getHex(), 13, 20)\n    if (floorRef.current) {\n      const mat = floorRef.current.material as THREE.Material & {\n        color?: THREE.Color\n        uniforms?: Record<string, { value: THREE.Color }>\n      }\n      if (mat?.color) mat.color.set(colors.floor)\n      else if (mat?.uniforms?.color) mat.uniforms.color.value.set(new THREE.Color(colors.floor))\n    }\n    if (carrotMarkerRef.current) {\n      const markerMat = carrotMarkerRef.current.material as THREE.MeshBasicMaterial\n      markerMat.color.set(colors.carrotBody)\n    }\n    if (carrotMarkerDotRef.current) {\n      const markerDotMat = carrotMarkerDotRef.current.material as THREE.MeshBasicMaterial\n      markerDotMat.color.set(colors.carrotLeaf)\n    }\n  }, [colors, scene])\n\n  // This effect intentionally excludes transient values to avoid reinitializing the entire scene graph.\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => {\n    // Scene setup\n    scene.fog = new THREE.Fog(new THREE.Color(colors.fog).getHex(), 13, 20)\n    camera.position.set(0, 4, 8)\n    camera.lookAt(0, 0, 0)\n\n    // Create floor simulation material\n    const floorSimMat = new THREE.ShaderMaterial({\n      uniforms: {\n        inputTexture: { value: null },\n        time: { value: 0.0 },\n        blade1PosOld: { value: new THREE.Vector2(0.5, 0.5) },\n        blade1PosNew: { value: new THREE.Vector2(0.5, 0.5) },\n        strength: { value: 0.0 },\n      },\n      vertexShader: `\n        precision highp float;\n        uniform float time;\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n          gl_Position = projectionMatrix * modelViewPosition; \n        }\n      `,\n      fragmentShader: `\n        precision highp float;\n        uniform sampler2D inputTexture;\n        uniform vec2 blade1PosOld;\n        uniform vec2 blade1PosNew;\n        uniform float strength;\n        uniform float time;\n        varying vec2 vUv;\n\n        float lineSegment(vec2 p, vec2 a, vec2 b, float thickness) {\n            vec2 pa = p - a;\n            vec2 ba = b - a;\n            float h = clamp(dot(pa,ba)/dot(ba,ba), 0.0, 1.0);\n            float idk = length(pa - ba*h);\n            return smoothstep(thickness, 0.2 * thickness, idk);\n        }\n\n        void main(void) {\n          vec4 prevTexture = texture2D(inputTexture, vUv);\n          vec3 col = prevTexture.rgb * 0.999;\n          if (strength > 0.0) {\n              float space = 0.001;\n              float crease = 0.001;\n              float thickness = 0.001 + strength * 0.001;\n              float leftRed = lineSegment(vUv + space, blade1PosOld, blade1PosNew, thickness);\n              float leftGreen = lineSegment(vUv + space + crease, blade1PosOld, blade1PosNew, thickness);\n              float rightRed = lineSegment(vUv - space - crease, blade1PosOld, blade1PosNew, thickness);\n              float rightGreen = lineSegment(vUv - space, blade1PosOld, blade1PosNew, thickness);\n              col.r += (leftRed + rightRed) * strength * 3.0;\n              col.g += (leftGreen + rightGreen) * strength * 3.0;\n              col.r = clamp(col.r, 0.0, 1.0);\n              col.g = clamp(col.g, 0.0, 1.0);\n          }\n          gl_FragColor = vec4(col, 1.0);\n        }\n      `,\n    })\n\n    floorSimMatRef.current = floorSimMat\n    bufferSimRef.current = new BufferSim(gl, 1024, 1024, floorSimMat)\n\n    // Create line\n    const lineMaterial = new THREE.LineDashedMaterial({\n      color: 0x7beeff,\n      linewidth: 1,\n      scale: 1,\n      dashSize: 0.2,\n      gapSize: 0.1,\n    })\n\n    const points = []\n    points.push(new THREE.Vector3(0, 0.2, 0))\n    points.push(new THREE.Vector3(3, 0.2, 3))\n    const lineGeometry = new THREE.BufferGeometry().setFromPoints(points)\n    const line = new THREE.Line(lineGeometry, lineMaterial)\n    scene.add(line)\n    lineRef.current = line\n\n    // Create particles\n    const bodyCount = 20\n    const tailCount = 5\n    const particleGeom = new THREE.BoxGeometry(0.2, 0.2, 0.2, 1, 1, 1)\n\n    const particles1: THREE.Mesh[] = []\n    const particles2: THREE.Mesh[] = []\n\n    for (let i = 0; i < bodyCount; i++) {\n      const m = new THREE.Mesh(particleGeom, bonusMatRef.current)\n      particles1.push(m)\n      m.scale.set(0, 0, 0)\n      scene.add(m)\n    }\n\n    for (let i = 0; i < tailCount; i++) {\n      const m = new THREE.Mesh(particleGeom, primMatRef.current)\n      particles2.push(m)\n      m.scale.set(0, 0, 0)\n      scene.add(m)\n    }\n\n    particlesRef.current = particles1\n    particles2Ref.current = particles2\n\n    // Create lighting\n    const ambientLight = new THREE.AmbientLight(0xffffff)\n    scene.add(ambientLight)\n\n    const directionalLight = new THREE.DirectionalLight(0xffffff, 1)\n    directionalLight.position.set(1, 5, 1)\n    directionalLight.castShadow = true\n    directionalLight.shadow.mapSize.width = 512\n    directionalLight.shadow.mapSize.height = 512\n    directionalLight.shadow.camera.near = 0.5\n    directionalLight.shadow.camera.far = 12\n    directionalLight.shadow.camera.left = -12\n    directionalLight.shadow.camera.right = 12\n    directionalLight.shadow.camera.bottom = -12\n    directionalLight.shadow.camera.top = 12\n    directionalLight.shadow.radius = 3\n    directionalLight.shadow.blurSamples = 4\n    scene.add(directionalLight)\n\n    // Load rabbit model\n    const loader = new GLTFLoader()\n    loader.load(\"/models/rabbit.glb\", (gltf) => {\n      const model = gltf.scene\n\n      // Get rabbit parts\n      const rabbit = model.getObjectByName(\"Rabbit\") as THREE.Group\n      const rabbitBody = model.getObjectByName(\"body\") as THREE.Mesh\n      const earRight = model.getObjectByName(\"earRight\") as THREE.Mesh\n      const earLeft = model.getObjectByName(\"earLeft\") as THREE.Mesh\n      const tail = model.getObjectByName(\"tail\") as THREE.Mesh\n      const footLeft = model.getObjectByName(\"footLeft\") as THREE.Mesh\n      const footRight = model.getObjectByName(\"footRight\") as THREE.Mesh\n      const eyeLeft = model.getObjectByName(\"eyeLeft\") as THREE.Mesh\n      const eyeRight = model.getObjectByName(\"eyeRight\") as THREE.Mesh\n      const carrot = model.getObjectByName(\"carrot\") as THREE.Mesh\n      const carrotLeaf = model.getObjectByName(\"carrotLeaf\") as THREE.Mesh\n      const carrotLeaf2 = model.getObjectByName(\"carrotLeaf2\") as THREE.Mesh\n\n      if (\n        rabbit &&\n        rabbitBody &&\n        earRight &&\n        earLeft &&\n        tail &&\n        footLeft &&\n        footRight &&\n        eyeLeft &&\n        eyeRight &&\n        carrot &&\n        carrotLeaf &&\n        carrotLeaf2\n      ) {\n        // Setup rabbit\n        carrot.rotation.z = 0.2\n        carrot.rotation.x = 0.2\n\n        // Apply materials\n        rabbitBody.material = primMatRef.current\n        earRight.material = primMatRef.current\n        earLeft.material = primMatRef.current\n        tail.material = primMatRef.current\n        footLeft.material = secMatRef.current\n        footRight.material = secMatRef.current\n        eyeLeft.material = secMatRef.current\n        eyeRight.material = secMatRef.current\n        carrot.material = bonusMatRef.current\n        carrotLeaf.material = leafMatRef.current\n        carrotLeaf2.material = leafMatRef.current\n\n        // Add outlines\n        const addOutline = (obj: THREE.Object3D) => {\n          const outline = obj.clone() as THREE.Mesh\n          outline.children = []\n          outline.position.set(0, 0, 0)\n          outline.rotation.x = 0\n          outline.rotation.y = 0\n          outline.rotation.z = 0\n          outline.scale.set(1, 1, 1)\n          outline.material = outlineMatRef.current\n          obj.add(outline)\n        }\n\n        addOutline(rabbitBody)\n        addOutline(earRight)\n        addOutline(earLeft)\n        addOutline(tail)\n        addOutline(carrot)\n\n        // Setup shadows\n        rabbit.traverse((object) => {\n          if ((object as THREE.Mesh).isMesh) {\n            object.castShadow = true\n            object.receiveShadow = true\n          }\n        })\n\n        carrot.traverse((object) => {\n          if ((object as THREE.Mesh).isMesh) {\n            object.castShadow = true\n          }\n        })\n\n        // Add to scene\n        scene.add(rabbit)\n        scene.add(carrot)\n\n        // Store references\n        rabbitRef.current = rabbit as THREE.Group\n        rabbitBodyRef.current = rabbitBody\n        earLeftRef.current = earLeft\n        earRightRef.current = earRight\n        carrotRef.current = carrot\n\n        setModelLoaded(true)\n      }\n    })\n\n    // Create reflective floor\n    const floor = new Reflector(new THREE.PlaneGeometry(floorSizeRef.current, floorSizeRef.current), {\n      color: new THREE.Color(colors.floor),\n      textureWidth: 1024,\n      textureHeight: 1024,\n    })\n    floor.rotation.x = -Math.PI / 2\n    floor.receiveShadow = true\n    scene.add(floor)\n    floorRef.current = floor\n\n    // Carrot ground marker\n    const carrotMarker = new THREE.Mesh(\n      new THREE.RingGeometry(0.25, 0.35, 32),\n      new THREE.MeshBasicMaterial({ color: new THREE.Color(colors.carrotBody), transparent: true, opacity: 0.65, side: THREE.DoubleSide }),\n    )\n    carrotMarker.rotation.x = -Math.PI / 2\n    carrotMarker.position.y = CARROT_MARKER_Y_OFFSET\n    carrotMarker.visible = false\n    scene.add(carrotMarker)\n    carrotMarkerRef.current = carrotMarker\n\n    const carrotMarkerDot = new THREE.Mesh(\n      new THREE.CircleGeometry(0.07, 24),\n      new THREE.MeshBasicMaterial({ color: new THREE.Color(colors.carrotLeaf), side: THREE.DoubleSide }),\n    )\n    carrotMarkerDot.rotation.x = -Math.PI / 2\n    carrotMarkerDot.position.y = CARROT_MARKER_Y_OFFSET + 0.005\n    carrotMarkerDot.visible = false\n    scene.add(carrotMarkerDot)\n    carrotMarkerDotRef.current = carrotMarkerDot\n\n    // Event listeners\n    const handleMouseMove = (event: MouseEvent) => {\n      mouseRef.current.x = (event.clientX / window.innerWidth) * 2 - 1\n      mouseRef.current.y = -(event.clientY / window.innerHeight) * 2 + 1\n    }\n\n    const handleTouchMove = (event: TouchEvent) => {\n      if (event.touches.length === 1) {\n        event.preventDefault()\n        mouseRef.current.x = (event.touches[0].clientX / window.innerWidth) * 2 - 1\n        mouseRef.current.y = -(event.touches[0].clientY / window.innerHeight) * 2 + 1\n      }\n    }\n\n    const handleClick = () => {\n      if (rabbitRef.current && !isJumping) {\n        jump()\n      }\n    }\n\n    window.addEventListener(\"mousemove\", handleMouseMove)\n    window.addEventListener(\"touchmove\", handleTouchMove, { passive: false })\n    window.addEventListener(\"mousedown\", handleClick)\n    window.addEventListener(\"touchstart\", handleClick)\n\n    return () => {\n      window.removeEventListener(\"mousemove\", handleMouseMove)\n      window.removeEventListener(\"touchmove\", handleTouchMove)\n      window.removeEventListener(\"mousedown\", handleClick)\n      window.removeEventListener(\"touchstart\", handleClick)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [scene, camera, gl, colors.floor, colors.fog])\n\n  // Helper functions\n  const getShortestAngle = (v: number) => {\n    let a = v % (Math.PI * 2)\n    if (a < -Math.PI) a += Math.PI * 2\n    else if (a > Math.PI) a -= Math.PI * 2\n    return a\n  }\n\n  const constrain = (v: number, vMin: number, vMax: number) => {\n    return Math.min(vMax, Math.max(vMin, v))\n  }\n\n  const raycast = () => {\n    if (!floorRef.current) return\n\n    raycasterRef.current.setFromCamera(mouseRef.current, camera)\n    const intersects = raycasterRef.current.intersectObject(floorRef.current)\n\n    if (intersects.length > 0 && intersects[0].uv) {\n      targetHeroUVPosRef.current.x = intersects[0].uv.x\n      targetHeroUVPosRef.current.y = intersects[0].uv.y\n    }\n  }\n\n  const hideCarrotMarker = useCallback(() => {\n    if (carrotMarkerRef.current) {\n      carrotMarkerRef.current.visible = false\n    }\n    if (carrotMarkerDotRef.current) {\n      carrotMarkerDotRef.current.visible = false\n    }\n  }, [])\n\n  const jump = () => {\n    if (!rabbitRef.current || !rabbitBodyRef.current || !earLeftRef.current || !earRightRef.current) return\n\n    setIsJumping(true)\n    const turns = Math.floor(heroSpeedRef.current.length() * 5) + 1\n    const jumpDuration = 0.5 + turns * 0.2\n    const targetRot = heroAngularSpeedRef.current > 0 ? Math.PI * 2 * turns : -Math.PI * 2 * turns\n\n    gsap.to(rabbitBodyRef.current.rotation, {\n      duration: jumpDuration,\n      ease: \"linear.none\",\n      y: targetRot,\n      onComplete: () => {\n        if (rabbitBodyRef.current) rabbitBodyRef.current.rotation.y = 0\n      },\n    })\n\n    gsap.to([earLeftRef.current.rotation, earRightRef.current.rotation], {\n      duration: jumpDuration * 0.8,\n      ease: \"power4.out\",\n      x: Math.PI / 4,\n    })\n\n    gsap.to([earLeftRef.current.rotation, earRightRef.current.rotation], {\n      duration: jumpDuration * 0.2,\n      delay: jumpDuration * 0.8,\n      ease: \"power4.in\",\n      x: 0,\n    })\n\n    gsap.to(jumpParamsRef.current, {\n      duration: jumpDuration * 0.5,\n      ease: \"power2.out\",\n      jumpProgress: 0.5,\n      onUpdate: () => {\n        if (!rabbitRef.current) return\n        const sin = Math.sin(jumpParamsRef.current.jumpProgress * Math.PI)\n        rabbitRef.current.position.y = Math.pow(sin, 4) * turns\n      },\n    })\n\n    gsap.to(jumpParamsRef.current, {\n      duration: jumpDuration * 0.5,\n      ease: \"power2.in\",\n      delay: jumpDuration * 0.5,\n      jumpProgress: 1,\n      onUpdate: () => {\n        if (!rabbitRef.current) return\n        const sin = Math.sin(jumpParamsRef.current.jumpProgress * Math.PI)\n        rabbitRef.current.position.y = Math.pow(sin, 1) * turns\n      },\n      onComplete: () => {\n        if (!rabbitRef.current) return\n        rabbitRef.current.position.y = 0\n        jumpParamsRef.current.jumpProgress = 0\n        setIsJumping(false)\n      },\n    })\n  }\n\n  const testCollision = () => {\n    if (isExplodingRef.current || !rabbitRef.current || !carrotRef.current) return\n\n    const distVec = rabbitRef.current.position.clone()\n    distVec.sub(carrotRef.current.position)\n    const l = distVec.length()\n\n    if (l <= 1 && carrotRef.current.visible) {\n      carrotRef.current.visible = false\n      hideCarrotMarker()\n      explode(carrotRef.current.position.clone())\n      onCarrotCollected()\n    }\n  }\n\n  const explode = (pos: THREE.Vector3) => {\n    isExplodingRef.current = true\n\n    const p1Count = particlesRef.current.length\n    const p2Count = particles2Ref.current.length\n\n    for (let i = 0; i < p1Count; i++) {\n      const m = particlesRef.current[i]\n      m.position.x = pos.x\n      m.position.y = pos.y\n      m.position.z = pos.z\n      m.scale.set(2, 2, 2)\n\n      gsap.to(m.position, {\n        x: pos.x + (-0.5 + Math.random()) * 1.5,\n        y: pos.y + (0.5 + Math.random()) * 1.5,\n        z: pos.z + (-0.5 + Math.random()) * 1.5,\n        duration: 1,\n        ease: \"power4.out\",\n      })\n\n      gsap.to(m.scale, {\n        x: 0,\n        y: 0,\n        z: 0,\n        duration: 1,\n        ease: \"power4.out\",\n        onComplete: () => {\n          spawnCarrot()\n          isExplodingRef.current = false\n        },\n      })\n    }\n\n    for (let i = 0; i < p2Count; i++) {\n      const m = particles2Ref.current[i]\n      m.position.x = pos.x\n      m.position.y = pos.y\n      m.position.z = pos.z\n      m.scale.set(2, 2, 2)\n\n      gsap.to(m.position, {\n        x: pos.x + (-0.5 + Math.random()) * 1.5,\n        y: pos.y + (0.5 + Math.random()) * 1.5,\n        z: pos.z + (-0.5 + Math.random()) * 1.5,\n        duration: 1,\n        ease: \"power4.out\",\n      })\n\n      gsap.to(m.scale, {\n        x: 0,\n        y: 0,\n        z: 0,\n        duration: 1,\n        ease: \"power4.out\",\n      })\n    }\n  }\n\n  const spawnCarrot = () => {\n    if (!carrotRef.current) return\n\n    hideCarrotMarker()\n\n    const spawnRange = isMobile ? 0.24 : 0.3\n    const px = (Math.random() - 0.5) * spawnRange\n    const py = (Math.random() - 0.5) * spawnRange\n    const h = 0.2 + Math.random() * 1\n    const spawnX = px * floorSizeRef.current\n    const spawnZ = py * floorSizeRef.current\n\n    carrotRef.current.position.x = spawnX\n    carrotRef.current.position.z = spawnZ\n    carrotRef.current.position.y = -1\n\n    carrotRef.current.scale.set(0, 0, 0)\n    carrotRef.current.visible = true\n\n    const shouldShowMarker = h > HIGH_CARROT_HEIGHT_THRESHOLD\n\n    if (shouldShowMarker && carrotMarkerRef.current && carrotMarkerDotRef.current) {\n      carrotMarkerRef.current.visible = true\n      carrotMarkerDotRef.current.visible = true\n      carrotMarkerRef.current.position.set(spawnX, CARROT_MARKER_Y_OFFSET, spawnZ)\n      carrotMarkerDotRef.current.position.set(spawnX, CARROT_MARKER_Y_OFFSET + 0.005, spawnZ)\n      carrotMarkerRef.current.scale.set(0.4, 0.4, 0.4)\n      carrotMarkerDotRef.current.scale.set(0, 0, 0)\n\n      gsap.to(carrotMarkerRef.current.scale, {\n        duration: 0.8,\n        ease: \"elastic.out\",\n        x: 1,\n        y: 1,\n        z: 1,\n      })\n\n      gsap.to(carrotMarkerDotRef.current.scale, {\n        duration: 0.6,\n        ease: \"back.out(1.7)\",\n        x: 1,\n        y: 1,\n        z: 1,\n      })\n    }\n\n    gsap.to(carrotRef.current.scale, {\n      duration: 1.5,\n      ease: \"elastic.out\",\n      x: 1,\n      y: 1,\n      z: 1,\n    })\n\n    gsap.to(carrotRef.current.position, {\n      duration: 1.5,\n      ease: \"elastic.out\",\n      y: h,\n    })\n  }\n\n  // Animation loop\n  useFrame((_, delta) => {\n    if (!modelLoaded) return\n\n    const dt = Math.min(delta, 0.3)\n    timeRef.current += dt\n\n    if (outlineMatRef.current) {\n      outlineMatRef.current.uniforms.time.value = timeRef.current\n    }\n\n    if (rabbitRef.current && lineRef.current && floorRef.current && floorSimMatRef.current && bufferSimRef.current) {\n      // Raycast to get mouse position on floor\n      raycast()\n\n      // Elastic string simulation\n      const clampRange = isMobile ? 0.22 : 0.3\n      const constrainUVPosX = constrain(targetHeroUVPosRef.current.x - 0.5, -clampRange, clampRange)\n      const constrainUVPosY = constrain(targetHeroUVPosRef.current.y - 0.5, -clampRange, clampRange)\n      targetHeroAbsPosRef.current.x = constrainUVPosX * floorSizeRef.current\n      targetHeroAbsPosRef.current.y = -constrainUVPosY * floorSizeRef.current\n\n      const dx = targetHeroAbsPosRef.current.x - rabbitRef.current.position.x\n      const dy = targetHeroAbsPosRef.current.y - rabbitRef.current.position.z\n\n      const angle = Math.atan2(dy, dx)\n      const heroDistance = Math.sqrt(dx * dx + dy * dy)\n      const ax = dx * dt * 0.3\n      const ay = dy * dt * 0.3\n\n      heroSpeedRef.current.x += ax\n      heroSpeedRef.current.y += ay\n\n      heroSpeedRef.current.x *= Math.pow(dt, 0.005)\n      heroSpeedRef.current.y *= Math.pow(dt, 0.005)\n\n      rabbitRef.current.position.x += heroSpeedRef.current.x\n      rabbitRef.current.position.z += heroSpeedRef.current.y\n\n      const targetRot = -angle + Math.PI / 2\n\n      if (heroDistance > 0.3) {\n        rabbitRef.current.rotation.y += getShortestAngle(targetRot - rabbitRef.current.rotation.y) * 3 * dt\n      }\n\n      heroAngularSpeedRef.current = getShortestAngle(rabbitRef.current.rotation.y - heroOldRotRef.current)\n      heroOldRotRef.current = rabbitRef.current.rotation.y\n\n      if (!isJumping && earLeftRef.current && earRightRef.current) {\n        earLeftRef.current.rotation.x = earRightRef.current.rotation.x = -heroSpeedRef.current.length() * 2\n      }\n\n      // Update line position\n      const linePositions = (lineRef.current.geometry as THREE.BufferGeometry).attributes.position.array\n      linePositions[0] = targetHeroAbsPosRef.current.x\n      linePositions[2] = targetHeroAbsPosRef.current.y\n      linePositions[3] = rabbitRef.current.position.x\n      linePositions[4] = rabbitRef.current.position.y\n      linePositions[5] = rabbitRef.current.position.z\n        ; (lineRef.current.geometry as THREE.BufferGeometry).attributes.position.needsUpdate = true\n      lineRef.current.computeLineDistances()\n\n      // Update floor simulation\n      heroNewUVPosRef.current.x = 0.5 + rabbitRef.current.position.x / floorSizeRef.current\n      heroNewUVPosRef.current.y = 0.5 - rabbitRef.current.position.z / floorSizeRef.current\n\n      floorSimMatRef.current.uniforms.time.value += dt\n      floorSimMatRef.current.uniforms.blade1PosNew.value = heroNewUVPosRef.current\n      floorSimMatRef.current.uniforms.blade1PosOld.value = heroOldUVPosRef.current\n      floorSimMatRef.current.uniforms.strength.value = isJumping ? 0 : 1 / (1 + heroSpeedRef.current.length() * 10)\n\n      bufferSimRef.current.render()\n\n      // Update floor material\n      if (floorRef.current.material instanceof THREE.ShaderMaterial) {\n        floorRef.current.material.uniforms.tScratches = { value: bufferSimRef.current.output.texture }\n      }\n\n      heroOldUVPosRef.current.copy(heroNewUVPosRef.current)\n\n      if (carrotRef.current) {\n        carrotRef.current.rotation.y += dt\n      }\n\n      // Test collision\n      testCollision()\n    }\n  })\n\n  return null\n}\n\nconst BunnyModal: React.FC<BunnyModalProps> = ({ onClose, theme }) => {\n  const portalRef = useRef<HTMLDivElement | null>(null)\n  const [mounted, setMounted] = useState(false)\n  const [carrotCount, setCarrotCount] = useState(() => {\n    if (typeof window === \"undefined\") return 0\n    return parseStoredCarrotCount(window.sessionStorage.getItem(CARROT_COUNT_STORAGE_KEY))\n  })\n  const isMobile = useIsMobile(768)\n  const carrotStorageWriteSkipRef = useRef(false)\n\n  useEffect(() => {\n    if (typeof document === \"undefined\") {\n      return\n    }\n\n    let host = document.getElementById(MODAL_ROOT_ID)\n    if (!host) {\n      host = document.createElement(\"div\")\n      host.id = MODAL_ROOT_ID\n      document.body.appendChild(host)\n    }\n\n    const container = document.createElement(\"div\")\n    host.appendChild(container)\n    portalRef.current = container\n    setMounted(true)\n\n    return () => {\n      if (portalRef.current && host?.contains(portalRef.current)) {\n        host.removeChild(portalRef.current)\n      }\n      if (host && host.childNodes.length === 0) {\n        host.remove()\n      }\n      portalRef.current = null\n    }\n  }, [])\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return\n    const handleStorage = (event: StorageEvent) => {\n      if (event.key !== CARROT_COUNT_STORAGE_KEY) return\n      const next = parseStoredCarrotCount(event.newValue)\n      setCarrotCount((prev) => {\n        if (prev === next) {\n          return prev\n        }\n        carrotStorageWriteSkipRef.current = true\n        return next\n      })\n    }\n    window.addEventListener(\"storage\", handleStorage)\n    return () => window.removeEventListener(\"storage\", handleStorage)\n  }, [])\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return\n    if (carrotStorageWriteSkipRef.current) {\n      carrotStorageWriteSkipRef.current = false\n      return\n    }\n    window.sessionStorage.setItem(CARROT_COUNT_STORAGE_KEY, carrotCount.toString())\n  }, [carrotCount])\n\n  const palette = BUNNY_MODAL_THEME_TOKENS[theme]\n  const sceneColors = useMemo<BunnySceneColors>(\n    () => ({\n      floor: palette[\"--game-floor\"],\n      fog: palette[\"--game-fog\"],\n      bunnyPrimary: palette[\"--bunny-primary\"],\n      bunnySecondary: palette[\"--bunny-secondary\"],\n      carrotBody: palette[\"--carrot-body\"],\n      carrotLeaf: palette[\"--carrot-leaf\"],\n      outline: palette[\"--game-outline\"],\n    }),\n    [palette],\n  )\n  const handleCarrotCollected = useCallback(() => {\n    setCarrotCount((prev) => prev + 1)\n  }, [])\n\n  if (!mounted || !portalRef.current) {\n    return null\n  }\n\n  return createPortal(\n    <div\n      style={{\n        position: \"fixed\",\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        backgroundColor: \"rgba(0, 0, 0, 0.9)\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        zIndex: 1000,\n      }}\n      onClick={onClose}\n    >\n      <div\n        style={{\n          position: \"relative\",\n          width: \"100%\",\n          height: \"100%\",\n          overflow: \"hidden\",\n          border: `8px solid ${palette[\"--game-border\"]}`,\n          borderRadius: isMobile ? \"18px\" : \"26px\",\n          boxSizing: \"border-box\",\n          boxShadow: `0 0 35px ${palette[\"--game-shadow\"]}`,\n        }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        <Canvas\n          shadows\n          gl={{\n            antialias: true,\n            preserveDrawingBuffer: true,\n            alpha: false,\n          }}\n          dpr={typeof window !== \"undefined\" ? window.devicePixelRatio : 1}\n          style={{\n            position: \"absolute\",\n            top: 0,\n            left: 0,\n            width: \"100%\",\n            height: \"100%\",\n            outline: \"none\",\n            cursor: \"grabbing\",\n          }}\n        >\n          <BunnyScene colors={sceneColors} onCarrotCollected={handleCarrotCollected} isMobile={isMobile} />\n        </Canvas>\n\n        <div\n          style={{\n            position: \"absolute\",\n            top: isMobile ? \"16px\" : \"26px\",\n            left: isMobile ? \"16px\" : \"30px\",\n            padding: \"8px 16px\",\n            borderRadius: 999,\n            fontFamily: \"monospace\",\n            fontSize: isMobile ? \"0.65rem\" : \"0.8rem\",\n            letterSpacing: \"0.1em\",\n            color: palette[\"--color-text\"],\n            backgroundColor: palette[\"--button-bg-light\"],\n            border: `1px solid ${palette[\"--game-border\"]}`,\n            zIndex: 1000,\n          }}\n        >\n          CARROTS  {carrotCount}\n        </div>\n\n        <div\n          style={{\n            position: \"absolute\",\n            width: \"100%\",\n            bottom: \"60px\",\n            fontFamily: \"'Open Sans', sans-serif\",\n            color: palette[\"--color-accent-primary\"],\n            fontSize: \"0.75em\",\n            textTransform: \"uppercase\",\n            textAlign: \"center\",\n            letterSpacing: \"0.3em\",\n          }}\n        >\n          - Press to jump -\n        </div>\n\n        <div\n          style={{\n            position: \"absolute\",\n            width: \"100%\",\n            bottom: \"20px\",\n            fontFamily: \"'Open Sans', sans-serif\",\n            color: palette[\"--color-text\"],\n            fontSize: \"0.7em\",\n            textTransform: \"uppercase\",\n            textAlign: \"center\",\n          }}\n        >\n          <button\n            type=\"button\"\n            style={{\n              color: palette[\"--color-accent-primary\"],\n              background: \"none\",\n              border: \"none\",\n              padding: 0,\n              cursor: \"pointer\",\n              fontFamily: \"inherit\",\n              fontSize: \"inherit\",\n              textTransform: \"inherit\",\n            }}\n            onClick={onClose}\n          >\n            close\n          </button>\n        </div>\n\n        <button\n          onClick={onClose}\n          style={{\n            position: \"absolute\",\n            top: \"15px\",\n            right: \"15px\",\n            width: \"36px\",\n            height: \"36px\",\n            borderRadius: \"50%\",\n            backgroundColor: palette[\"--button-bg-light\"],\n            color: palette[\"--color-text\"],\n            border: \"none\",\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            fontSize: \"16px\",\n            cursor: \"pointer\",\n            zIndex: 1001,\n          }}\n        >\n          \n        </button>\n      </div>\n    </div>,\n    portalRef.current,\n  )\n}\n\nexport default BunnyModal\n"],"names":["MODAL_ROOT_ID","CARROT_MARKER_Y_OFFSET","CARROT_COUNT_STORAGE_KEY","parseStoredCarrotCount","value","parsed","parseInt","Number","isNaN","BufferSim","constructor","renderer","width","height","shader","orthoScene","fbos","current","output","orthoCamera","orthoQuad","this","THREE","fbo","wrapS","wrapT","minFilter","magFilter","format","type","stencilBuffer","depthBuffer","texture","generateMipmaps","clone","add","render","uniforms","inputTexture","setRenderTarget","BunnyScene","_ref","colors","onCarrotCollected","isMobile","scene","gl","camera","useThree","modelLoaded","setModelLoaded","useState","isJumping","setIsJumping","rabbitRef","useRef","rabbitBodyRef","earLeftRef","earRightRef","carrotRef","carrotMarkerRef","carrotMarkerDotRef","floorRef","lineRef","bufferSimRef","floorSimMatRef","particlesRef","particles2Ref","heroSpeedRef","heroOldRotRef","heroAngularSpeedRef","heroOldUVPosRef","heroNewUVPosRef","targetHeroUVPosRef","targetHeroAbsPosRef","jumpParamsRef","jumpProgress","isExplodingRef","mouseRef","raycasterRef","floorSizeRef","timeRef","primMatRef","color","bunnyPrimary","secMatRef","bunnySecondary","bonusMatRef","carrotBody","leafMatRef","carrotLeaf","outlineMatRef","size","time","vertexShader","fragmentShader","side","useEffect","set","outline","fog","getHex","_mat$uniforms","mat","material","floor","position","lookAt","floorSimMat","blade1PosOld","blade1PosNew","strength","lineMaterial","linewidth","scale","dashSize","gapSize","points","push","lineGeometry","setFromPoints","line","particleGeom","particles1","particles2","i","m","ambientLight","directionalLight","castShadow","shadow","mapSize","near","far","left","right","bottom","top","radius","blurSamples","GLTFLoader","load","gltf","model","rabbit","getObjectByName","rabbitBody","earRight","earLeft","tail","footLeft","footRight","eyeLeft","eyeRight","carrot","carrotLeaf2","rotation","z","x","addOutline","obj","children","y","traverse","object","isMesh","receiveShadow","Reflector","textureWidth","textureHeight","Math","PI","carrotMarker","transparent","opacity","visible","carrotMarkerDot","handleMouseMove","event","clientX","window","innerWidth","clientY","innerHeight","handleTouchMove","touches","length","preventDefault","handleClick","jump","addEventListener","passive","removeEventListener","getShortestAngle","v","a","constrain","vMin","vMax","min","max","hideCarrotMarker","useCallback","turns","jumpDuration","targetRot","gsap","to","duration","ease","onComplete","delay","onUpdate","sin","pow","explode","pos","p1Count","p2Count","random","spawnCarrot","spawnRange","px","py","h","spawnX","spawnZ","useFrame","_","delta","dt","raycast","setFromCamera","intersects","intersectObject","uv","clampRange","constrainUVPosX","constrainUVPosY","dx","dy","angle","atan2","heroDistance","sqrt","ax","ay","linePositions","geometry","attributes","array","needsUpdate","computeLineDistances","tScratches","copy","testCollision","distVec","sub","_ref2","onClose","theme","portalRef","mounted","setMounted","carrotCount","setCarrotCount","sessionStorage","getItem","useIsMobile","carrotStorageWriteSkipRef","document","host","getElementById","createElement","id","body","appendChild","container","_host","contains","removeChild","childNodes","remove","handleStorage","key","next","newValue","prev","setItem","toString","palette","BUNNY_MODAL_THEME_TOKENS","sceneColors","useMemo","handleCarrotCollected","createPortal","_jsx","style","backgroundColor","display","flexDirection","justifyContent","alignItems","zIndex","onClick","_jsxs","overflow","border","borderRadius","boxSizing","boxShadow","e","stopPropagation","Canvas","shadows","antialias","preserveDrawingBuffer","alpha","dpr","devicePixelRatio","cursor","padding","fontFamily","fontSize","letterSpacing","textTransform","textAlign","background"],"sourceRoot":""}